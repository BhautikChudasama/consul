---
layout: docs
page_title: Consul-Terraform-Sync Configuration
description: >-
  Consul-Terraform-Sync requires a Terraform Provider, a Terraform Module and a running Consul Cluster outside of the consul-terraform-sync daemon.
---

# Consul-Terraform-Sync Configuration

This topic contains configuration reference information for Consul-Terraform-Sync (CTS). Pass configuration settings in an HCL or JSON configuration file to configure the CTS daemon. Refer to the [HashiCorp Configuration Language reference](https://github.com/hashicorp/hcl) for additional information about the HCL syntax.

## Configuration model

The following list outlines filed hierarchy, data types, and requirements in the CTS configuration. Click on a property name to view additional details, including default values:

- [`log_level`](#log_level): string 
- [`working_dir`](#workfing_dir): string
- [`port`](#port): number
- [`id`](#id): string
- [`syslog`](#syslog): map
  - [`enabled`](#syslog): boolean
  - [`facility`](#syslog): string
  - [`name`](#syslog): string
- [`buffer_period`](#buffer_period): map
  - [`enabled`](#bufferperiod): boolean
  - [`min`](#bufferperiod): string
  - [`max`](#bufferperiod): string
- [`tls`](#tls): map
  - [`enabled`](#tls): boolean 
  - [`cert`](#tls): string
  - [`key`](#tls): string
  - [`verify_incoming`](#tls): boolean
  - [`ca_cert`](#tls): string
- [`license_path`](#license_path): string | <EnterpriseAlert inline /> | deprecated, use `license` instead  
- [`license`](#license): map | <EnterpriseAlert inline />
  - [`path`](#license): string
  - [`auto_retrieval`](#license): map
    - [`enabled`](#license): string
- [`consul`](#consul): map
  - [`address`](#consul-address): string | `localhost:8500`
  - [`auth`](#consul-auth): map
    - [`enabled`](#consul-auth): boolean | `false`
    - [`username`](#consul-auth): string
    - [`password`](#consul-auth): string
  - [`tls`](#consul-tls): map
    - [`enabled`](#consul-tls): boolean | `false`
    - [`verify`](#consul-tls): boolean | `true`
    - [`ca_cert`](#consul-tls): string
    - [`ca_path`](#consul-tls): string
    - [`cert`](#consul-tls): string
    - [`key`](#consul-tls): string
    - [`server_name`](#consul-tls): string
  - [`token`](#consul-token): string 
  - [`transport`](#consul-transport): map
    - [`dial_keep_alive`](#consul-transport): string | `30s`
    - [`dial_timeout`](#consul-transport): string | `30s`
    - [`disable_keep_alives`](#consul-transport): boolean | `false`
    - [`idle_conn_timeout`](#consul-transport): string | `5s`
    - [`max_idle_conns`](#consul-transport): number | `0`
    - [`max_idle_conns_per_host`](#consul-transport): number | `100`
    - [`tls_handshake_timeout`](#consul-transport): string | `10s`
  - [`service_registration`](#consul-serviceregistration): map
    - [`enabled`](#consul-serviceregistration): boolean | `true`
    - [`service_name`](#consul-serviceregistration): string | `consul-terraform-sync`
    - [`address`](#consul-serviceregistration): string
    - [`default_check`](#consul-serviceregistration): map
      - [`enabled`](#consul-serviceregistration): boolean | `true` 
      - [`address`](#consul-serviceregistration): string
- [`high_availability`](#high_availability): map | <EnterpriseAlert inline />
  - [`cluster`](#high_availability-cluster): map
    - [`name`](#high_availability-cluster-name): string
    - [`storage`](#high_availability-cluster-storage): map
      - [`parent_path`](#high_availability-cluster-storage): string | `consul-terraform-sync/<cluster-name>`
      - [`namespace`](#high_availability-cluster-storage): string | `default`
      - [`session_ttl`](#high_availability-cluster-storage): string | `15s`
  - [`instance`](#high_availability-instance): map
    - [`address`](#high_availability-instance): string
- [`service`](#service): map | deprecated, use `condition` instead
  - [`name`](#service): string | required when defining the `service` block
  - [`id`](#service): string
  - [`description`](#service): string
  - [`datacenter`](#service): string 
  - [`namespace`](#service): string 
  - [`filter`](#service): string
  - [`cts_user_defined_meta`](#service): map of strings
- [`task`](#task): map 
  - [`name`](#task-name): string
  - [`description`](#task-description): string
  - [`enabled`](#task-true): boolean
  - [`providers`](#task-providers): list of strings
  - [`services`](#task-service): list of strings | deprecated, use `module_input` instead
  - [`module`](#task-module): string
  - [`variable_files`](#task-variable_files): list of strings
  - [`version`](#task-version): string
  - [`working_dir`](#task-working_dir): string
  - [`buffer_period`](#task-buffer_period): map
    - [`enabled`](#task-buffer_period): boolean
    - [`min`](#task-buffer_period): string | `5s`
    - [`max`](#task-buffer_period): string | `20s`
  - [`condition "services"`](#task-condition-services): map | a `condition "<type>"` is required
    - [`regexp`](#task-condition-services): string | required if `names` is not set
    - [`names`](#task-condition-services): string | required if `regexp` is not set
    - [`datacenter`](#task-condition-services): string 
    - [`namespace`](#task-condition-services): string | <EnterpriseAlert inline/>
    - [`filter`](#task-condition-services): filter
    - [`cts_user_defined_meta`](#task-condition-services): Map of strings
    - [`source_includes_var`](#task-condition-services): boolean | `true` | deprecated, use `use_as_module_input` instead
    - [`use_as_module_input`](#task-condition-services): boolean | `true`
  - [`condition "catalog-services"`](#task-condition-catalog-services) map | a `condition "<type>"` is required
    - [`regexp`](#task-condition-catalog-services): string | required
    - [`datacenter`](#task-condition-catalog-services): string
    - [`namespace`](#task-condition-catalog-services): string | <EnterpriseAlert inline/>
    - [`node_meta`](#task-condition-catalog-services): map of strings
    - [`source_includes_var`](#task-condition-catalog-services): boolean | `true` | deprecated, use `use_as_module_input` instead
    - [`use_as_module_input`](#task-condition-catalog-services): boolean | `true`  
  - [`condition "consul-kv"`](#task-condition-consul-kv) map | a `condition "<type>"` is required
    - [`path`](#task-condition-consul-kv): string
    - [`recurse`](#task-condition-consul-kv): boolean | `false`
    - [`datacenter`](#task-condition-consul-kv): string
    - [`namespace`](#task-condition-consul-kv): string | <EnterpriseAlert inline/>
    - [`source_includes_var`](#task-condition-consul-kv): boolean | `true` | deprecated, use `use_as_module_input` instead
    - [`use_as_module_input`](#task-condition-consul-kv): boolean | `true`
  - [`condition "schedule"`](#task-condition-schedule)  map | a `condition "<type>"` is required
    - [`cron`](#task-condition-schedule): string
  - [`source_input`](#task-source-input): map | deprecated, use `module_input` instead
  - [`module_input "services"`](#task-module_input-services): map
      - [`regexp`](#task-module_input-services): map | required if `names` is not set
      - [`names`](#task-module_input-services): string | required if `regexp` is not set
      - [`datacenter`](#task-module_input-services): string
      - [`namespace`](#task-module_input-services): string | <EnterpriseAlert inline/>
      - [`filter`](#task-module_input-services): filter
      - [`cts_user_defined_meta`](#task-module_input-services): Map of strings
  - [`module_input "consul-kv"`](#task-module_input-consul-kv): map
    - [`path`](#task-module_input-consul-kv): string
    - [`recurse`](#task-module_input-consul-kv): boolean | `false`
    - [`datacenter`](#task-module_input-consul-kv): string
    - [`namespace`](#task-module_input-consul-kv): string | <EnterpriseAlert inline/>
  - [`terraform_version`](#task-terraform_version): string
  - [`terraform_cloud_workspace`](#task-terraform_cloud_workspace): map | <EnterpriseAlert inline/> 
- [`driver "terraform"`](#driver-terraform): map | a `driver "<type>"` is required
  - [`backend`](#driver-terraform-backend): map
    - [`azurerm`](#driver-terraform-backend): map
    - [`consul`](#driver-terraform-backend): map
    - [`cos`](#driver-terraform-backend): map
    - [`gcs`](#driver-terraform-backend): map
    - [`kubernetes`](#driver-terraform-backend): map
    - [`local`](#driver-terraform-backend): map
    - [`manta`](#driver-terraform-backend): map
    - [`pg`](#driver-terraform-backend): map
    - [`s3`](#driver-terraform-backend): map
  - [`log`](#driver-terraform-log): boolean | `false`
  - [`path`](#driver-terraform-path): string
  - [`persist_log`](#driver-terraform-persist_log): boolean | `false`
  - [`required_providers`](#driver-terraform-required_providers): map | required
    - [`<NAME OF LOCAL PROVIDER>`](#driver-terraform-required_providers): map
      - [`source`](#driver-terraform-required_providers): string
      - [`version`](#driver-terraform-required_providers): string
  - [`version`](#driver-terraform-version): string
- [`driver "terraform-cloud"`](#driver-terraform-cloud): map | <EnterpriseAlert inline/> | a `driver "<type>"` is required
  - [`hostname`](#driver-terraform-cloud-hostname): string
  - [`organization`](#driver-terraform-cloud-organization): string
  - [`token`](#driver-terraform-cloud-token): string | required
  - [`workspace_prefix`](#driver-terraform-cloud-workspace_prefix): string | deprecated, use `workspaces.prefix` instead
  - [`workspaces`](#driver-terraform-cloud-workspaces): map
    - [`prefix`](#driver-terraform-cloud-workspaces): string
    - [`tags`](#driver-terraform-cloud-workspaces): list of strings
    - [`tags_allowlist`](#driver-terraform-cloud-workspaces): list of strings
    - [`tags_denylist`](#driver-terraform-cloud-workspaces): list of strings
  - [`required_providers`](#driver-terraform-cloud-required_providers): map | required
    - [`<NAME OF LOCAL PROVIDER>`](#driver-terraform-cloud-required_providers): map
      - [`source`](#driver-terraform-cloud-required_providers): string
      - [`version`](#driver-terraform-cloud-required_providers): string
  - [`tls`](#driver-terraform-cloud-tls): map
    - [`enabled`](#driver-terraform-cloud-tls): boolean
    - [`ca_cert`](#driver-terraform-cloud-tls): string
    - [`ca_path`](#driver-terraform-cloud-tls): string
    - [`cert`](#driver-terraform-cloud-tls): string
    - [`key`](#driver-terraform-cloud-tls): string
    - [`server_name`](#driver-terraform-cloud-tls): string
    - [`verify`](#driver-terraform-cloud-tls): boolean
- [`terraform_provider "<provider>"`](#terraform_provider): map
  - [`task_env`](#terraform_provider-task_env): map
  - [`alias`](#terraform_provider-alias): string

## Complete configuration

When every field is defined, a CTS configuration has the following form:

```hcl
log_level   = "INFO" 
working_dir = "sync-tasks"
port        = 8558
id          = "cts-01"

syslog {
  enabled = true
  name = "<name>"
  facility = "local2"
}

buffer_period {
  enabled = true
  min     = "5s"
  max     = "20s"
}

tls {
  enabled         = true
  cert            = "/path/to/cert.pem"
  key             = "/path/to/key.pem"
  verify_incoming = true
  ca_cert         = "/path/to/ca.pem"
}

license {         // For enterprise editions
  path = "path/to/license.lic"
  auto_retrieval {
    enabled = true
  }
}

consul {
  address = "localhost:8500"
  auth {
    enabled = true
    username = "<username>"
    password = "<password>"
  }
  tls {
    enabled         = true
    verify          = true
    ca_cert         = "/path/to/ca.pem"
    ca_path         = "/path/to/ca-pem/dir"
    cert            = "/path/to/cert.pem"
    key             = "/path/to/key.pem"
    server_name     = "<SNI server>"    
  }
  token = null
  transport {
    dial_keep_alive         = "30s"
    dial_timeout            = "30s"
    disable_keep_alives     = false
    idle_conn_timeout       = "5s"
    max_idle_conns          = 0
    max_idle_conns_per_host = 100
    tls_handshake_timeout   = "10s"
  }
  service_registration {
    service_name = "cts"
    address = "172.22.0.2"
    default_check {
      address = "http://172.22.0.2:8558"
    }
  }
}

high_availability {
  cluster {
    name    = "<name of cluster operating with HA enabled>"
    storage {
      parent_path = "consul-terraform-sync/<cluster-name>"
      namespace   = "default"
      session_ttl = "15s"
  }
  instance {
    address = "<CTS instance IP to advertise to other instances>"
  }
}
service {
  name        = "<name>"
  id          = "<ID>"
  datacenter  = "dc1"
  description = "All instances of the service web in datacenter dc1"
  namespace  = "<enterprise only>"
  filter      = "<expression for filtering services>"
  cts_user_defined_meta {
    "<key>" = "<value>"
  }
 }
 
task {
  name           = "taskA"
  description    = ""
  enabled        = true
  providers      = []
  module         = "org/example/module"
  variable_files = []
  version        = "<version>"
  working_dir    = "<overrides main working_dir>"
  buffer_period {
    enabled     = true
    min         = "5s"
    max         = "20s"
  }
  condition "<type>" { 
    <params specific to condition type> 
  }
  module_input "<type>" {
    <params specific to condition and module type>   
  }
} 

driver "terraform" { // YOU CAN ONLY SPECIFY ONE DRIVER CONFIGURATION 
  backend "<type>" {
    <params specific to backend type> 
  }
  log         = false
  persist_log = false
  path        = ""
  required_providers {
    <name of local provider> {
      source  = "<global source address>"
      version = "<version>"
    }
  }
}
  
driver "terraform-cloud" { // YOU CAN ONLY SPECIFY ONE DRIVER CONFIGURATION
  hostname     = "https://app.terraform.io"
  organization = "my-org"
  token        = "<TEAM_TOKEN>"
  // We recommend setting a token queried from Vault, for example: 
  // token = "{{ with secret \"secret/my/path\" }}{{ .Data.data.foo }}{{ end }}"

  workspaces {
    prefix         = "<workspaces that start with this value>"
    tags           = ["source:cts"]
    tags_allowlist = []
    tags_denylist  = []
  }

  required_providers {
    <provider name> = {
      source  = "<namespace>/<provider name>"
      version = "<version>"
    }
  }
  tls {
    enabled     = true
    ca_cert     = "path/to/ca.pem"
    ca_path     = "path/to/ca/pem/dir"
    cert        = "path/to/cert.pem"
    key         = "path/to/PEM-encoded/private/key/file"
    server_name = "<SNI server>"
    verify      = true
}
 
terraform_provider "foo" {
  alias = "<alias name>"
  <key> = "<value>"
  task_env {
    "FOO_TOKEN" = "{{ env \"CTS_FOO_TOKEN\" }}"
  }
}
```

## Specification

This section provides details about the fields you can configure in the CTS configuration.

### `log_level`

Specifies amount of detail printed to the log when CTS is running. You can specify one of the following levels"

- `TRACE`
- `DEBUG`
- `INFO` - default 
- `WARN`
- `ERR`

#### Values

- Data type: string
- Default: `INFO`

### `working_dir`

Specifies the base working directory for managing the artifacts generated by CTS for each task, including Terraform configuration files. CTS also generates a subdirectory for each task, for example, `./sync-tasks/task-name`. The subdirectory is the working directory for the task. You can specify task-level working directories that override this configuration in the [`task.working_dir`](#task-workingdir) field.

#### Values

- Data type: String
- Default: `sync-tasks`

### `port`

Specifies the port CTS uses to serve API requests.

#### Values

- Data type: Number
- Default: `8558`

### `id` 

Specifies the ID of the CTS instance. CTS uses the ID as the service ID for CTS if service registration is enabled. CTS also uses the ID to identify the instance in a high availability cluster.

#### Values

- Data type: String
- Default: Generated ID with the format `cts-<hostname>`

### `syslog`

Map of settings that specify the syslog server configuration to use for logging. The following table describes the parameters you can define in the `syslog` map:

| Parameter | Description | Data type | Default |
| --- | --- | --- | --- |
| `enabled` | Set to `true` to explicitly enable syslog logging. Specifying any other parameter in the `syslog` map also enables syslog logging. | Boolean | None |
| `facility` | Specifies the name of the syslog facility to log to. | String | `local0` |
| `name` | Specifies a name to use for the daemon process when logging to syslog. | String | `consul-terraform-sync` |

 
### `buffer_period` 

Map of settings that configures the default buffer period for all dynamic tasks. Configuring a buffer period reduces the effects of _flapping services_ for downstream network devices. Flapping refers to when a component changes state too frequently, which can result in errors. Buffer periods do not apply to scheduled tasks.

The following table describes the parameters you can define the `buffer_period` map:

| Parameter | Description | Data type | Default |
| --- |---|---------| --- |
| `enabled` | Set to `true` to enable buffer periods globally. Specifying `min` also enables buffer periods. | Boolean | `true` |
| `min` | Specifies the minimum amount of time to wait after changes are detected before triggering related tasks. | String  | `5s` |
| `max` | Specifies the maximum amount of time to wait after changes are detected before triggering related tasks. If `min` is set, the default period for `max` is four times the value of `min`. | String  | `20s` |

#### Values

- Data type: Map
- Default: The default configuration intended to reduce the number of times downstream infrastructure is updated within a short period of time. 

### `tls`

Map of settings that configure TLS for the CTS API. The following table describes the parameters you can define the `tls` map:

| Parameter | Description | Data type | Default |
| --- |---|--| --- |
| `enabled` | Set to `true` to explicitly enable TLS. Providing a value for any of the TLS options will enable this parameter implicitly. | Boolean | `false` | 
| `cert` | Specifies the path to a PEM-encoded certificate file used for TLS connections to the CTS API. | String | None |
| `key` | Specifies the path to the PEM-encoded private key file used with the certificate configured by `cert`. | String | None |
| `verify_incoming` | Set to `true` to enable mutual TLS. When enabled, all incoming connections to the CTS API must use a TLS connection and provide a certificate signed by a certificate authority specified in the `ca_cert` or `ca_path` parameter. | Boolean | `false` |
| `ca_cert` | Specifies the path to a PEM-encoded certificate authority file used to verify the authenticity of the incoming client connections to the CTS API when `verify_incoming` is set to true. Takes precedence over `ca_path` if both are configured. | String | None |
| `ca_path` | Specifies the path to a directory of PEM-encoded certificate authority files used to verify the authenticity of the incoming client connections to the CTS API when `verify_incoming` is set to true. | String | None |

#### Values

- Data type: Map
- Default: None

### `license_path` <EnterpriseAlert inline />  
 
**Deprecated in CTS 0.6.0. Use [`license`](#license) instead.** Specifies the path to a file that contains the license. You must specify a license in order to use enterprise features. You can also set the license by defining the `CONSUL_LICENSE` and `CONSUL_LICENSE_PATH` environment variables. For more information, refer to [Setting the License](/consul/docs/cts/enterprise#setting-the-license). 

### `license` <EnterpriseAlert inline />

Map that specifies how CTS loads an enterprise license. The following table describes parameters you can define the `license` map:

| Parameter | Description | Type | Default |
| --------- | -------- | ---- | ------- |
| `path` | Specifies the path to a file containing an enterprise license. When set, CTS uses the license until you enable automatic license retrieval. You can also set the license by defining the `CONSUL_LICENSE` and `CONSUL_LICENSE_PATH` environment variables. To learn more, review [Setting the License](/consul/docs/cts/enterprise#setting-the-license). | String | None |
| `auto_retrieval` |  Map that contains the `enabled` field. Set `enabled` to `true` to enable CTS to automatically retrieve a license. Refer to [Eanble auto-retrieval](/consul/docs/cts/configure#auto-retrieval) for additional information. | None |

### `consul`

Map that configures the CTS connection to a Consul agent so that CTS can perform queries for task execution. It also configures the automatic registration of CTS as a service with Consul. The `consul` block contains the following fields:

- [`address`](#consul-address)
- [`auth`](#consul-auth)
- [`tls`](#consul-tls)
- [`token`](#consul-token)
- [`transport`](#consul-transport)
- [`service_registration`](#consul-serviceregistration)

#### Values

- Data type: Map
- Default: None

### `consul.address`

Specifies the address of the Consul agent. You can use an IP or fully-qualified domain name (FQDN). 

#### Values 

- Data type: String
- Default: `localhost:8500` 

### `consul.auth`

Map that configures basic HTTP authentication settings so that CTS can connect to Consul. The following table describes parameters you can define in the `auth` map:

| Parameter | Description | Type |  Default |
| --------- | -------- | ----  ------- |
| `enabled` | Enables using HTTP basic authentication| Boolean | `false` |
| `username` | Username for authentication | String | None |
| `password` | Password for authentication | String | None |

#### Values

- Data type: Map
- Default: None

### `consul.tls`

Map that configures the settings for connecting to the Consul agent over TLS. Configure TLS to use a secure client connection with Consul. Connecting to the Consul agent over HTTP/2 can solve issues related to reaching Consul's maximum connection limits, as well as improve efficiency when processing many blocking queries. 

You must configure Consul-Terraform-Sync to use TLS when the TLS verification for HTTPS connections is configured on the Consul agent. Refer to the [`verify_incoming` option](/consul/docs/agent/config/config-files#verify_incoming) in the Consul agent configuration reference documentation for additional information.

The following table describes parameters you can define in the `consul.tls` map:

| Parameter | Description | Type | Default |
| --------- |  ---- | ----------- | ------- |
| `enabled` | Set to `true` to explicitly enable TLS. Providing a value for any of the TLS options enables this parameter implicitly. | Boolean |  `false` |
| `verify` | Set to `true` to enable TLS peer verification, which checks the global certificate authority (CA) chain to verify that the certificates Consul returns are valid. | Boolean | `true` |
| `ca_cert` | Specifies the path to a PEM-encoded certificate authority file used to verify the authenticity of the connection to Consul over TLS.<br/><br/>You can also set the path using the `CONSUL_CACERT` environment variable. | String | None |
| `ca_path` | Specifies the path to a directory of PEM-encoded certificate authority files used to verify the authenticity of the connection to Consul over TLS.<br/><br/>You can also set the path using the `CONSUL_CAPATH` environment variable. | String | None |
| `cert` | Specifies the path to a PEM-encoded client certificate file provided to Consul over TLS in order for Consul to verify the authenticity of the connection from CTS. This parameter is required when `verify_incoming` is set `true` in the Consul agent configuration.<br/><br/>You can also set the path using the `CONSUL_CLIENT_CERT` environment variable. | String | None |
| `key` | The path to the PEM-encoded private key file used with the client certificate configured by `cert`. Required if Consul has `verify_incoming` set to true.<br/><br/>Can also set the path using the `CONSUL_CLIENT_KEY` environment variable. | String | None |
| `server_name` | Specifies the name to use as the server name indication (SNI) for Consul when connecting over TLS.<br/><br/>You can also set the SNI using the `CONSUL_TLS_SERVER_NAME` environment variable. | String | None |

### `consul.token`

Specifies the ACL token to use for client communication with the local Consul agent. Refer to [ACL requirements](/consul/docs/cts/run#acl-requirements) for additional information. You can also provide the token using the `CONSUL_TOKEN` or `CONSUL_HTTP_TOKEN` environment variable. 

#### Values

- Data type: String
- Default: None

### `consul.transport`

Specifies low-level network connection details. The following table describes the parameters you can configure in the `transport` map: 

| Parameter | Description | Type | Default |
| --- | --- | --- | --- | 
| `dial_keep_alive` | Specifies how long to persist a connection. | String | `30s` |
| `dial_timeout` | Specifies how long CTS should wait for the connection to establish before timing out. | String | `30s` |
| `disable_keep_alives` | Set to `true` to configure CTS to use persistent connections. Disabling persistent connections significantly decreases. | Boolean | `false`|
| `idle_conn_timeout` | Specifies how long a connection can remain idle before timing out. | String  | `5s` |
| `max_idle_conns` | Specifies the maximum number of total idle connections that CTS allows across all hosts. The limit is disabled by default. | Integer |  `0` |
| `max_idle_conns_per_host` | Specifies the maximum number of idle connections per remote host. CTS establishes most connections with the Consul agent. | Integer | `100`|
| `tls_handshake_timeout` | Specifies the amount of time to wait to complete the TLS handshake. | string | `10s`|

#### Values

- Data type: Map
- Default: None
- 
### `consul.service_registration`

Map of configurations that determine how CTS registers itself as a service with Consul. CTS automatically registers itself with Consul as a service with a health check. CTS uses the value set in the global [`id`](#id) configuration as the service ID. CTS deregisters itself with Consul when CTS stops gracefully. If CTS is unable to register with Consul, then it logs the error and continues without exiting.

Service registration requires an ACL token with `service:write` permissions for the CTS service. Refer to [ACL requirements](/consul/docs/cts/run#acl-requirements) for additional information.

The following table describes the parameters you can set in the `service_registration` map:

| Parameter | Type | Description | Default |
| --------- | ---- | ----------- | ------- |
| `enabled` | Enables CTS to register itself as a service with Consul. When service registration is enabled for a CTS instance configured for high availability, the instance also registers itself with a new tag using the `cts-cluster:<cluster-name>` format. Refer to [Run Consul-Terraform-Sync](/consul/docs/cts/run) for additional information.| Boolean  | `true` |
| `service_name` | Specifes the service name for CTS. We recommended specifying the same name used for [`high_availability.cluster.name`](#high-availability-cluster) value if CTS is configured for high availability. Refer to [Run Consul-Terraform-Sync](/consul/docs/cts/run) for additional information. | String | `consul-terraform-sync` |
| `address` | Specifies the IP address or hostname for CTS. | String | IP address of the Consul agent node |
| `namespace` | <EnterpriseAlert inline /> Specifies the namespace to register CTS in. | String | In order of precedence: <br/> 1. Inferred from the CTS ACL token <br/> 2. The `default` namespace. |
| `default_check.enabled` | Enables CTS to create the default health check. | Boolean |  `true` |
| `default_check.address` | The address to use for the default HTTP health check. Needs to include the scheme (`http`/`https`) and the port, if applicable. | String |  `http://localhost:<port>` or `https://localhost:<port>`. Determined from the [`port` configuration](#port) and whether [`tls`](#tls) is enabled on the CTS API. |

The default health check is an [HTTP check](/consul/docs/register/services/vm/health-checks#http-checks) that calls the [Health API](/consul/docs/reference/cts/api/health). The following table describes the values CTS sets for this default check, corresponding to the [Consul register check API](/consul/api-docs/agent/check#register-check). If an option is not listed in this table, then CTS is using the default value.

| Parameter | Value |
| --------- | ----- |
| Name | `CTS Health Status`|
| ID | `<id>-health` |
| Namespace | `service_registration.namespace` |
| Notes | `Check created by Consul-Terraform-Sync`|
| DeregisterCriticalServiceAfter | `30m` |
| ServiceID | [`id`](#id) |
| Status | `critical` |
| HTTP | `<default_check.address>/v1/health` |
| Method | `GET` |
| Interval | `10s` |
| Timeout | `2s` |
| TLSSkipVerify | `false` |

#### Values

- Data type: Map
- Default: None

### `high_availability` <EnterpriseAlert inline />

Add a `high_availability` block to your configuration to enable CTS to run in high availability mode. Refer to [Run Consul-Terraform-Sync with High Availability](/consul/docs/cts/run#run-consul-terraform-sync-with-high-availability) for additional information. The `high_availability` block contains the following configuration items.

- [`cluster`](#high_availability-cluster)
- [`instance`](#high_availability-instance)

#### Values

- Data type: Map
- Default: None

### `high_availability.cluster`

Map that contains configurations for the cluster you want to operate in high availability mode. The `cluster` block contains the following configuration items:

- [`name`](#high_availability-cluster-name)
- [`instance`](#high_availability-cluster-storage)

#### Values

- Data type: Map
- Default: None

### `high_availability.cluster.name`

Specifies the name of the cluster operating with high availability enabled.

#### Values

- Data type: String
- This field is required when operating CTS in high-availability mode.
- Default: None

### `high_availability.cluster.storage` 

Map of configurations that define how CTS stores state information. Refer to [State storage and persistence](/consul/docs/cts/architecture#state-storage-and-persistence) for additional information. 

The following table describes the parameters you can configure in the `storage` map:

| Parameter | Description| Type | Default  |
| --------- | ---------- | -------- | ------|
| `parent_path` | Defines a parent path in the Consul KV for CTS to store state information. CTS automatically appends the cluster name to the parent path. |  String | `consul-terraform-sync/<cluster-name>` |
| `namespace` | Specifies the namespace to use when storing state in the Consul KV. Default is inferred from the CTS ACL token. | String | `default` |
| `session_ttl` | Specifies the session time-to-live for leader elections. You must specify a value greater than the `session_ttl_min` configured for Consul. A longer `session_ttl` results in a longer leader election after a failover. | String | `15s` |

### `high_availability.instance`

Map that contains configurations specific to the CTS instance. 

The `instance` block contains the `address` parameter. The address parameter is an optional string that specifies the IP address of the CTS instance to advertise to other instances. The `address` parameter does not have a default value.

#### Values

- Data type: Map containing the `address` parameter
- Default: None


### `service`

**The `service` block is deprecated since v0.5.0. Use [`task.condition`](#task-condition) and [`task.module_input`](#task-module_input) instead. Refer to [0.5.0 release notes](/consul/docs/release-notes/consul-terraform-sync/v0_5_x#deprecate-service-block) for additional information.**

Map that explicitly defines the services configured in the [`task.service`](#task-service) block. A `service` block is only necessary for services that have non-default values, such as custom datacenters.When the `service` block is not configured, CTS uses default values, such as `datacenter = dc1`, to reference services registered with Consul.

Define multiple `service` blocks to explicitly configure multiple services. When a `service` block is configured, the `task.services` can references the service name or ID. When no `service` block is configured, tasks can only reference the service  by name.

The `service` block does not define services configured in the `task` block's `condition "services"` or `module_input "services` blocks.

The following table describes the parameters you can define in the `service` block:

| Parameter | Description | Type |  Default |
| --------- | -------- | ---- | ------- |
| `name` |  Consul logical name of the service. | String | None |
| `id` |  Specifies the service ID CTS uses to explicitly identify the service configuration for a task. If no ID is provided, the service is identified by the service name within a [task definition](#task). | String | None |
| `description` |  Human-readable text to describe the service | String | None |
| `datacenter` |  Name of a datacenter to query for the task. | String | Datacenter of the agent that CTS queries. |
| `namespace`  | <EnterpriseAlert inline /> Namespace of the services to query for the task. | String | In order of precedence: <ol><li>Inferred from the CTS ACL token</li><li>`default` namespace.</li></ol> |
| `filter` |  Defines an expression that filters services. Refer to [Filtering](/consul/api-docs/health#filtering-2) and [Creating Expresssions](/consul/api-docs/features/filtering#creating-expressions) in the API reference documentation for additional information. | String | None |
| `cts_user_defined_meta` | Specifies user-defined metadata to append to the [service input variable](/consul/docs/cts/create-terraform-module#services-input-variable) for Terraform modules. Refer to the module configured for the task for information about metadata usage, expected keys, and format. <br/><br/> If multiple tasks depend on the same service but require different metadata, you can declare different sets of metadata for the same service. Define multiple service blocks for the service with unique IDs and identical names for those blocks. CTS can separate the metadata per task based on the service IDs.  | Map of strings | None|

#### Values

- Data type: Map
- Default: None 

### `task`

Map that specifies which task to execute when CTS runs Terraform. You can configure multiple `task` blocks to run multiple tasks. When `task` block is not specified in your configuration, you can add them to a running CTS instance by calling the [`/tasks` API endpoint](/consul/docs/reference/cts/api/tasks#tasks) or running the [`task` command](/consul/docs/reference/cts/cli/task#task).

The `task` block may contain the following blocks:

- [`name`](#task-name)
- [`description`](#task-description)
- [`enabled`](#task-true)
- [`providers`](#task-providers)
- [`services`](#task-services): Deprecated, use `module_input` instead
- [`module`](#task-module)
- [`version`](#task-version)
- [`working_dir`](#task-working_dir) 
- [`variable_files`](#task-variable_files)
- [`buffer_period`](#task-buffer_period)
- [`condition "services"`](#task-condition-services), [`condition "catalog-services"`](#task-condition-catalog-services), [`condition "consul-kv"`](#task-condition-consul-kv), or [`condition "schedule"`](#task-condition-schedule)
- [`module_input "services"`](#task-module_input-services)
- [`module_input "consul-kv"`](#task-module_input-consul-kv)
- [`terraform_version`](#task-terraform_version)
- [`terraform_cloud_workspace`](#task-terraform_cloud_workspace)

#### Values

- Data type: Map
- Default: None

### `task.name` 

Specifies the unique name of the task. A task name must start with a letter or underscore and may contain only letters, digits, underscores, and dashes.

#### Values

- Data type: String
- The `name` is required when defining tasks.
- Default: None

### `task.description`

Specifies human-readable text to describe the task.

#### Values

- Data type: String
- Default: None

### `task.enabled`
 
Set to `true` to allow CTS to run the task and manage its resources.

#### Values

- Data type: Boolean
- Default: None

### `task.providers`

Specifies a list of provider names or aliases the task depends on. CTS maps the values specified in the `providers` list to the [`terraform_provider` configuration](#terraform_provider). When specifying a Terraform provider configuration alias, use the `<name>.<alias>` format. Refer to [Reuse a Terraform provider configuration](#reuse-a-terraform-provider-configuration) for an example. 

A task can use multiple providers, but only one provider instance of a provider is allowed per task.

#### Values

- Data type: List of strings
- Default: None

### `task.services` 

**Deprecated since v0.5.0.** Use [`condition`](#task-condition) or [`module_input`](#task-module_input) instead. Refer to the [0.5.0 release notes](/consul/docs/release-notes/consul-terraform-sync/v0_5_x#deprecate-services-field) for additional information. 

Specifies a list of logical service names or service IDs that the task monitors for changes in the Consul catalog. CTS monitors services in the `default` namespace unless a different namespace is explicitly defined for services with matching IDs in a `service` block. 

The `services` configuration has different behaviors depending on the [`task.condition`](#task-condition) configuration:
  - No `condition` block configured: The `services` configuration acts as the task's condition and provides the services information as a module input.
  - `condition` block set to type `services`: CTS returns an error because `services` is incompatible with this type of `condition`. Both parameters configure the services module input. 
  - `condition` block set to any other type: The `services` configuration only provides services module input.

#### Values

- Data type: List of strings
- Default: None

### `task.source`  

**Deprecated since v0.5.0.** Use [`task.module`](#task-module) instead.

Specifies the location of the source code for the Terraform module.

#### Values

- Data type: String
- Default: None

### `task.module` 

Specifies the location of the source code for the Terraform module. You can specify a local module or a remote module on the [Terraform registry](https://registry.terraform.io/) or private module registry. Refer to [Module Sources](/terraform/language/modules/sources) in the Terraform documentation for additional information.

When configuring CTS to use a module on the local machine, specify the directory path. For remote modules, use the following syntax to specify the module's location:

| Module type | Syntax | Example |
| --- | --- | --- |
| Public | `<NAMESPACE>/<MODULE NAME>/<PROVIDER>` | `module = "mkam/hello/cts"` |
| Private  |  `<HOSTNAME>/<ORGANIZATION>/<MODULE NAME>/<PROVIDER>` | `module = "my.tfe.hostname.io/my-org/hello/cts"` |

#### Values

- Data type: String
- Default: None

### `task.variable_files` 

Specifies a list of paths to Terraform variable definition files. The definition files should only contain variable name assignments. The variable assignments must match the corresponding variable declarations defined in the Terraform module for the task. Refer to [Variable Definition (`.tfvars`) Files](/terraform/language/values/variables#variable-definitions-tfvars-files) in the Terraform documentation for additional information.

CTS loads variables in the order that they appear in the files. CTS overwrites duplicate variables with the values that appear later in the file. Unless specified by the module, configure arguments for Terraform providers in the [`terraform_provider` block](#terraform-provider).

Refer to [Terraform variable definition file](#terraform-variable-definition-file) for an example variable definition.

#### Values

- Data type: List of strings
- Default: None

### `task.version` 

Specifies the version of the module to use. CTS uses the latest version by default.

#### Values

- Data type: String
- Default: `latest`

### `task.working_dir`
 
Specifies a working directory to store and manage artifacts generated by CTS for the task, including Terraform configuration files. By default, a working directory is created for each task as a subdirectory in the base [`working_dir`](#working_dir), for example, `sync-tasks/task-name`.

#### Values

- Data type: String
- Default: `<task name>`

### `task.buffer_period` 

Map of settings that specify the minimum and maximum amount of time to wait for the cluster to reach a consistent state and accumulate changes before triggering task execution. Configuring a buffer period reduces the effects of _flapping services_ for downstream network devices. Flapping refers to when a component changes state too frequently, which can result in errors. Buffer periods do not apply to scheduled tasks.

The buffer period configurations specified in the `task` override the global [`buffer_period`](#buffer_period) settings. Buffer periods do not apply to scheduled tasks. 

The following table describes the parameters you can define the `buffer_period` map:

| Parameter | Description | Data type | Default |
| --- |---|---------| --- |
| `enabled` | Set to `true` to enable buffer periods for the task. Specifying `min` also enables buffer periods. | Boolean | `true` |
| `min` | Specifies the minimum amount of time to wait after changes are detected before triggering related tasks. | String  | `5s` |
| `max` | Specifies the maximum amount of time to wait after changes are detected before triggering related tasks. If `min` is set, the default period for `max` is four times the value of `min`. | String  | `20s` |


### `task.condition "services"` 

Specifies a condition that triggers CTS to execute the task when CTS detects changes for the specified services. CTS monitors services that match either the regular expression configured in `regexp` field or service names listed in the `names` field. Either `regexp` or `names` must be configured, but not both.

The `task.condition "<type">` specifies a condition that triggers CTS to execute the task. You can only configure one `task.condition "<type">` per task. Refer to the following parameters for information about other condition types you can define in the task:

- [`condition "catalog-services"`](#task-condition-catalog-services)
- [`condition "consul-kv"`](#task-condition-consul-kv)
- [`condition "schedule"`](#task-condition-schedule)

You can only set the monitored services' information for a task using one configuration option. As a result, services conditions have the following restrictions:

- You cannot configure the task with the `services` field, which is deprecated.
- You cannot configure the task with a `module_input "services"` block.
- You cannot configure the task with a `source_input "services"` block, which is deprecated.

Refer to [Task Execution: Services Condition](/consul/docs/cts/tasks#services-condition) for details on how CTS triggers tasks that contain services conditions. The following table describes the parameters you can set for the `condition "services'` block:

| Parameter | Description  | Data type | Default |
| --- | --- | --- | --- |  
| `regexp` | Specifies a regular expression that matches Consul service names. CTS applies the task to services with matching names. <br/><br/>Either `regex` or `names` is required, but not both. <br/><br/>When a list of names and a regex are necessary, you can include the list as part of the regex or create separate tasks. Refer to the [regular expression syntax documentation](https://github.com/google/re2/wiki/Syntax) for additional information. You can also test expressions using the [MatchString tool](https://golang.org/pkg/regexp/#Regexp.MatchString).  | String | None |
| `names` | Specifies a list Consul service names to monitor. Only services that have their name listed in `names` are used by the task. Either `regex` or `names` is required, but not both. | List of strings | None |
| `datacenter` |  Specifies the name of a datacenter to query for the task. | String | Datacenter of the agent that CTS queries. |
| `namespace`  | <EnterpriseAlert inline /> Specifies the namespace containing services to query for the task. | String  | In order of precedence: <ol><li>Inferred from the CTS ACL token</li><li> `default`</li></ol> |
| `filter` |  Specifies an expression that filters service names. <br/><br/> Refer to the [services filtering documentation](/consul/api-docs/health#filtering-2) and [Creating Expressions](/consul/api-docs/features/filtering#creating-expressions) in the API documentation for additional information.  | String | None |
| `cts_user_defined_meta` | Specifies metadata to append to the [service input variable](/consul/docs/cts/create-terraform-module#services-module-input). Refer to the module configured for the task for information about metadata usage, expected keys, and format. | Map of strings | None|
| `source_includes_var` | **Deprecated since v0.5.0**. Use `use_as_module_input` field instead. | Boolean | `true` |
| `use_as_module_input` | Set to `true` to allow CTS to use condition values as inputs for the [`services` variable](/consul/docs/cts/create-terraform-modules#services-variable) for the Terraform module.<br/><br/>Refer to the selected module's documentation for guidance on how to configure this field. If configured inconsistently with the module, CTS returns an error and exits. | Boolean | `true` |

#### Values

- Data type: Map
- A `condition "<type>"` field is required.
- Default: None

### `task.condition "catalog-services"` 

The `condition "catalog-services"` condition triggers the task the first time a service instance registers with Consul and when the last service instance de-registers.

The `task.condition "<type">` specifies a condition that triggers CTS to execute the task. You can only configure one `task.condition "<type">` per task. Refer to the following parameters for information about other condition types you can define in the task:

- [`condition "services"`](#task-condition-services)
- [`condition "consul-kv"`](#task-condition-consul-kv)
- [`condition "schedule"`](#task-condition-schedule)

The following table describes the parameters you can configure for the `condition "catalog-services"` block:

| Parameter | Description | Data type | Default |
| -------- | ---- | ----------- | ------- |
| `regexp` | Specifies a regular expression that matches Consul service names. CTS applies the task to services with matching names. Refer to the [regular expression syntax documentation](https://github.com/google/re2/wiki/Syntax) for additional information. You can also test expressions using the [MatchString tool](https://golang.org/pkg/regexp/#Regexp.MatchString). This field is required. | String |  None |
| `datacenter` |  Specifies the name of a datacenter to query for the task. | String | Datacenter of the agent that CTS queries. |
| `namespace`  | <EnterpriseAlert inline /> Specifies the namespace containing services to query for the task. | String  | In order of precedence: <ol><li>Inferred from the CTS ACL token</li><li> `default`</li></ol> |
| `node_meta`  | Specifies node metadata key-value pairs that CTS uses to filter services. The task only uses services registered at a node with the specified key-value pairs.  | Map of strings | None |
| `source_includes_var` | **Deprecated since v0.5.0.** Use `use_as_module_input` instead. | Boolean | `true` |
| `use_as_module_input` | Set to `true` to allow CTS to use condition values as inputs for the [`services` variable](/consul/docs/cts/create-terraform-modules#services-variable) for the Terraform module.<br/><br/>Refer to the selected module's documentation for guidance on how to configure this field. If configured inconsistently with the module, CTS returns an error and exits. | Boolean | `true` |

#### Values

- Data type: Map 
- A `condition "<type>"` field is required.
- Default: None

### `task.condition "consul-kv"` 

The `condition "consul-kv"` condition triggers the task on changes to a Consul KV entry. You can configure a single Consul KV entry or any Consul KV entries prefixed with a given path. 

The `task.condition "<type">` specifies a condition that triggers CTS to execute the task. You can only configure one `task.condition "<type">` per task. Refer to the following parameters for information about other condition types you can define in the task:

- [`condition "services"`](#task-condition-services)
- [`condition "catalog-services"`](#task-condition-catalog-services)
- [`condition "schedule"`](#task-condition-schedule)

You cannot configure the task with a `module_input "consul-kv"` or `source_input "consul-kv"` (deprecated) block for Consul KV conditions. Any Consul KV module input that the task needs should be configured solely through the `condition` block. Refer to [Task Execution: Consul KV Condition](/consul/docs/cts/tasks#consul-kv-condition) for additional information on how CTS triggers tasks that contain Consul KV conditions.

The following table describes the parameters you can configure in the `condition "consul-kv"` block:

| Parameter | Description | Data type | Default |
| --------- | ---- | ----------- | ------- |
| `path` |  Specifies the path to the key. The path can point to a single Consul KV entry or several entries within the path. | String | None |
| `recurse` |  Set to `true` to enable CTS to treat the `path` value as a prefix. When set to `false`, CTS processes the `path` value as a literal match. | Boolean | `false` |
| `datacenter` |  Specifies the name of a datacenter to query. | Datacenter of the agent that CTS queries. | String |
| `namespace`  | <EnterpriseAlert inline /> Specifies the namespace containing services to query for the task. | String  | In order of precedence: <ol><li>Inferred from the CTS ACL token</li><li> `default`</li></ol> |
| `source_includes_var` | **Deprecated since v0.5.0.** Use `use_as_module_input` instead.| Boolean | `true` |
| `use_as_module_input` | Set to `true` to enable CTS to use condition values as inputs for the [`consul_kv` variable](/consul/docs/cts/create-terraform-module#consul-kv-variable) for the Terraform module.<br/><br/>Refer to the selected module's documentation for guidance on how to configure this field. When configured inconsistently with the module, CTS returns an error and exits. | Boolean | `true` |

#### Values

- Data type: Map
- A `condition "<type>"` field is required.
- - Default: None

### `task.condition "schedule"` 

The `condition "schedule"` condition defines the schedule for executing the task. This condition type does not dynamically trigger on changes in Consul. Schedule tasks also rely on the `module_input` configuration. Refer to [`module_input "services"`](#task.module_input-services) and [`module_input "consul-kv"`](#task-module_input-consul-kv) for additional information.

The `task.condition "<type">` specifies a condition that triggers CTS to execute the task. You can only configure one `task.condition "<type">` per task. Refer to the following parameters for information about other condition types you can define in the task:

- [`condition "services"`](#task-condition-services)
- [`condition "catalog-services"`](#task-condition-catalog-services)
- [`condition "consul-kv"`](#task-condition-consul-kv)

The `condition "schedule"` condition contains a `cron` parameter. The `cron` parameter is a required string that specifies the schedule for triggering the task. Refer to [cronexpr parsing library](https://github.com/hashicorp/cronexpr)for information about creating CRON expressions.

Refer to the following topics for additional information:
- [Task Execution: Schedule Condition](/consul/docs/cts/tasks#schedule-condition) describes how schedule conditions trigger tasks.
- [Terraform Module: Module Input](/consul/docs/cts/create-terraform-modules#module-input) describes how to configure module input options for a scheduled task.
- Refer to [Task condition types](#task-condition-types) for example condition configurations.

#### Values

- Data type: Map
- A `condition "<type>"` field is required.
- Default: None

### `task.source_input` 

**Deprecated since v0.5.0.** Use `module_input` instead.

### `task.module_input "services"` 

Specifies services registered with Consul that are tagged with metadata. The task uses the metadata as inputs for the Terraform module. Refer to [Services module input](/consul/docs/cts/create-terraform-module#services-module-input) for additional information.

You cannot configure a task with a `condition` and `module_input` block of the same type. For example, configuring `condition "consul-kv"` and `module_input "consul-kv"` causes an error because both configure the `consul_kv` variable.

The `module_input` block contains inputs the module requires for task execution that supplement the inputs specified in the `condition` block. You can configure multiple `module_input` blocks per task, but you cannot configure more than one of the same type. For example, you can only specify one `module_input "services"` per task.

A task that monitors services can only contain one of the following configurations:
 
- `condition "services"` block
- `module_input "services"` block

Refer to [Module input types](#module-input-types) for example configurations.

The following table describes parameters you can configure in the `module_input "services"` block:

| Parameter | Description | Type |  Default |
| --------- | -------- | ---- | ------- |
| `regexp` | Regular expression the task uses to match the names of Consul services to monitor. The task only uses services that have a name that matches the regular expression. <br/><br/> When a list and a regex are required, include the list as part of the regex or create separate tasks. Required if `names` is not configured | String | None |
| `names` | Specifies the names of Consul services to monitor. Required if `regexp` is not configured | List of strings | None |
| `datacenter` | Specifies the name of a datacenter to query for the task. | String |  Datacenter of the agent that CTS queries. |
| `namespace`  | <EnterpriseAlert inline /> Specifies the namespace containing services to query for the task. | String | In order of precedence: <ol><li>Inferred from the CTS ACL token</li><li>`default`</li></ol> |
| `filter` |  Specifies an expression that filters service names. <br/><br/> Refer to the [services filtering documentation](/consul/api-docs/health#filtering-2) and [Creating Expressions](/consul/api-docs/features/filtering#creating-expressions) in the API documentation for additional information.  | String | None |
| `cts_user_defined_meta` | Specifies metadata to append to the [service input variable](/consul/docs/cts/create-terraform-module#services-module-input). Refer to the module configured for the task for information about metadata usage, expected keys, and format. | Map of strings | None|

#### Values

- Data type: Map
- Default: None

### `task.module_input "consul-kv"`

The `module_input "consul-kv"` input type defines changes to the Consul KV that CTS monitors for. When CTS detects the changes, the task provides them to the Terraform module when it triggers Terraform. Refer to [Consul KV module input](/consul/docs/cts/create-terraform-modules#consul-kv-module-input) for additional information. 

The `module_input` block contains inputs the module requires for task execution that supplement the inputs specified in the `condition` block. You can configure multiple `module_input` blocks per task, but you cannot configure more than one of the same type. For example, you can only specify one `module_input "consul-kv"` per task.

You can configure Consul KV module inputs for a single KV entry or for any KV entries that are prefixed with a given path. Refer to [Module input types](#module-input-types) for example `module_input` configurations.

The following table describes the parameters you can configure in the `module_input "consul-kv"` block:

| Parameter | Description | Data type | Default |
| --------- | ---- | ----------- | ------- |
| `path` |  Specifies the path to the key. The path can point to a single Consul KV entry or several entries within the path. | String | None |
| `recurse` |  Set to `true` to enable CTS to treat the `path` value as a prefix. When set to `false`, CTS processes the `path` value as a literal match. | Boolean | `false` |
| `datacenter` |  Specifies the name of a datacenter to query. | Datacenter of the agent that CTS queries. | String |
| `namespace`  | <EnterpriseAlert inline /> Specifies the namespace containing services to query for the task. | String  | In order of precedence: <ol><li>Inferred from the CTS ACL token</li><li> `default`</li></ol> |

#### Values

- Data type: Map
- Default: None

### `task.terraform_version` <EnterpriseAlert inline />

Deprecated since v0.6.0, use [`terraform_cloud_workspace.terraform_version`](#task-terraform_cloud_workspace-terraform-version) instead. 

Specifies the version of Terraform to use for the Terraform Cloud workspace associated with the task. By default, the task uses the latest compatible version of Terraform supported by the organization. You can only configure this setting when the task uses the  Terraform Cloud driver. Refer to [Configure Consul-Terraform-Sync](/consul/docs/cts/configure) for additional information.

#### Values

- Data type: String
- Default: None

### `task.terraform_cloud_workspace` <EnterpriseAlert inline /> 

Map that defines the attributes for the Terraform Cloud workspace associated with the task. You must use [`driver "terraform-cloud"`](#driver-terraform-cloud) to configure attributes in the `terraform_cloud_workspace` configuration. To configure attributes for all workspaces, refer to [`driver.workspaces`](#driver-workspaces).

The following table describes the attributes you can define in the `terraform_cloud_workspace` configuration:

| Attribute | Description | Data type | Default |
| --------- | ---- | ----------- | ------- |
| `execution_mode` | Specifes the task execution mode. You can specify one of the following modes: <li>`remote`: Directs the task to use Terraform Cloud as the Terraform execution platform.</li><li>`agent`: Directs the task to use a Terraform Cloud agent as the Terraform execution platform.</li> | String | `remote` | 
| `agent_pool_id` | Specifies the ID of the agent pool that runs the Terraform workloads. The task only supports `agent_pool_id` when `execution_mode` is set to `agent`. Either `agent_pool_id` or `agent_pool_name` are required if `execution_mode` is set to `agent`. `agent_pool_id` takes precedence over `agent_pool_name` when both are provided. | String | None |
| `agent_pool_name` | Specifies the name of the agent pool that runs the Terraform workloads. The task only supports `agent_pool_name` when `execution_mode` is set to `agent`. Either `agent_pool_id` or `agent_pool_name` are required. `agent_pool_id` takes precedence over `agent_pool_name` when both are provided. | String  | None |
| `terraform_version` | Specifies the version of Terraform to use for the Terraform Cloud workspace associated with the task. | String | Latest compatible version supported by the organization. |


### `driver "terraform"`

Map that directs CTS to install and run the Terraform CLI locally so that CTS can automate network infrastructure changes.  

CTS requires a driver configuration that specifies the subprocess to run during automation. By default, CTS uses `driver "terraform"`, which automates Terraform as a local installation of the Terraform CLI. Only one network driver can be configured per deployment of CTS.

The `driver "terraform"` block contains the following fields:

- [`backend`](#driver-terraform-backend)
- [`log`](#driver-terraform-log)
- [`path`](#driver-terraform-path)
- [`persist_log`](#driver-terraform-persist_log)
- [`required_providers`](#driver-terraform-required_providers)
- [`version`](#driver-terraform-version)

#### Values

- Data type: Map
- A driver configuration is required.
- Default: None

### `driver "terraform".backend`

Map that defines how Terraform stores Terraform state files for each task. Refer to [Terraform state files](/terraform/language/state) for additional information about Terraform state files.

If you do not specify a backend configuration, CTS generates default values and uses configurations in the [`consul` block](#consul) to configure Consul as the backend. The Consul backend stores Terraform state files in the Consul KV. The Consul KV path is the base path to store state files for tasks. The full path for each state file is the task identifier appended to the end of the path, for example `consul-terraform-sync/terraform-env:task-name`.

CTS uses the ACL token provided for Consul authentication to read and write to the KV store. As a result, you must link the token to a policy that grants read and write permissions to Consul's KV store. 

You cannot use the remote enhanced backend with the Terraform driver to run operations in Terraform Cloud. Instead, use [`driver "terraform_cloud"`](#driver-terraform-cloud) to integrate CTS with Terraform Cloud for remote workspaces and remote operations.

You can configure CTS to use the following backends in the `driver "terraform` block. Click on a backend to open its reference documentation: 

- [`azurerm`](/terraform/language/settings/backends/azurerm)
- [`consul`](/terraform/language/settings/backends/consul): Default 
- [`cos`](/terraform/language/settings/backends/cos)
- [`gcs`](/terraform/language/settings/backends/gcs)
- [`kubernetes`](/terraform/language/settings/backends/kubernetes)
- [`local`](/terraform/language/settings/backends/local): Not supported with CTS instances configured for high availability. Refer to [Run Consul-Terraform-Sync](/consul/docs/cts/run) for additional information.
- [`manta`](/terraform/language/v1.2.x/settings/backends/manta): Deprecated
- [`pg`](/terraform/language/settings/backends/pg)
- [`s3`](/terraform/language/settings/backends/s3)  

#### Values

- Data type: Map
- Default: `consul`

### `driver "terraform".log` 

Set to `true` to enable CTS to include stderr and stdout in the CTS log, which helps debugging and development activities. Log aggregators that expect a uniform log format may have difficulty when this option is enabled.

#### Values

- Data type: Boolean
- Default: `false`

### `driver "terraform".path` 
 
Specifies the file path to install Terraform or to discover an existing Terraform binary. By default, CTS installs Terraform in the same directory as the CTS daemon. To resolve an incompatible Terraform version or to use a different version of Terraform, remove the existing binary or specify a different path.

#### Values

- Data type: String
- Default: Directory where CTS daemon is installed.

### `driver "terraform".persist_log`

Set to `true` to enable CTS to save a trace-level log to disk per task for each Terraform client. Alternatively, you can set the `TF_LOG_PATH` environment variable to `<work_dir>/terraform.log`. Trace logs result in verbose logging and may be useful for debugging and development purposes. We do not recommend enabling this for production because CTS does not rotate logs, which may quickly result in large files.

#### Values

- Data type: Boolean
- Default: `false`
 
### `driver "terraform".required_providers` 

Map that declares the Terraform providers CTS must use across all tasks. CTS processes the requirements when preparing each task that uses the provider. The `required_providers` block contain the name of a local provider. Each local provider contains the following fields:

- `source`: Specifies the global source address for the provider. 
- `version`: Specifies the required version of the provider.

Refer to [`terraform.required_providers`](/terraform/language/providers/requirements#requiring-providers) in the Terraform documentation for additional information about declaring required providers in a Terraform configuration.

#### Values

- Data type: Map
- This field is required.
- Default: None

### `driver "terraform".version` 

Specifies the version of Terraform to install and run in automation for task execution. By default, the driver installs the latest compatible release of Terraform. Refer to the [versions compability reference](/consul/docs/reference/cts/compatibility) for additional information. 

Remove the existing binary or change the path to install a different version. Verify that the desired Terraform version is compatible across all Terraform modules used for CTS automation.

#### Values

- Data type: String
- Default: Latest compatible version

### `driver "terraform-cloud"` <EnterpriseAlert inline/>

Map that enables enterprise editions of CTS to integrate with Terraform Cloud or Terraform enterprise. Refer to the [Terraform product page](https://www.hashicorp.com/products/terraform) for additional information about HashiCorp's paid offerings of Terraform. 

CTS requires a driver configuration that specifies the subprocess to run during automation. By default, CTS uses [`driver "terraform"`](#driver-terraform), which automates Terraform as a local installation of the Terraform CLI. Only one network driver can be configured per deployment of CTS. Refer to [Network drivers overview](/consul/docs/cts/network-drivers) for additional information about network drivers.

The `driver "terraform-cloud"` block contains the following fields:

- [`hostname`](#driver-terraform-cloud-hostname)
- [`organization`](#driver-terraform-cloud-organization)
- [`token`](#driver-terraform-cloud-token)
- [`workspace_prefix`](#driver-terraform-cloud-workspace_prefix)
- [`workspaces`](#driver-terraform-cloud-workspaces)
- [`required_providers`](#driver-terraform-cloud-required_providers)
- [`tls`](#driver-terraform-cloud-tls)

#### Values

- Data type: Map
- A driver configuration is required.
- Default: None

### `driver "terraform-cloud.hostname`

Specifies the Terraform Cloud hostname to connect to. You can set the `TFC_HOSTNAME` environment variable to override the `hostname`.

#### Values

- Data type: String
- Default: None

### `driver "terraform-cloud".organization` 
 
Specifies the Terraform Cloud organization that hosts the workspaces CTS manages. You can set the `TFC_ORGANIZATION` environment variable to override the `organization`.

#### Values

- Data type: String
- Default: None

### `driver "terraform-cloud".token` 

Specifies the team API token used for authentication with Terraform Cloud. The token must have workspace permissions.Refer to [Team API token](/terraform/cloud-docs/users-teams-organizations/api-tokens#team-api-tokens) in the Terraform documentation for additional information. You can set the `TFC_TOKEN` environment variable to override the `token`.
 
We recommend creating dedicated a team and team API token to isolate automation by CTS from other Terraform Cloud operations.

#### Values 

- Data type: String
- Default: None

### `driver "terraform-cloud".workspace_prefix` 

**Deprecated since v0.5.0**, use [`workspaces.prefix`](#driver-terraform-cloud-workspaces-prefix) instead. 

Specifies a prefix to prepend to the workspace names that CTS automatically generates. CTS adds the prefix to all tasks that use the driver. By default, CTS uses the task name for the workspace name. 

Configuring the `workspace_prefix` generates names according to the `<workspace_prefix value>-<task name>` format. For example, a `workspace_prefix` set to `cts` produces the following name for a task named `task-firewall`:

`cts-task-firewall`

#### Values

- Data type: String
- Default: None

### `driver "terraform-cloud".workspaces` 

Map that defines how CTS manages Terraform Cloud workspaces. The following table describes the parameters you can configure in the `workspaces` block:

| Parameter | Description | Data type | Default |
| --------- | ---- | ----------- | ------- |
| `prefix` | Specifies a prefix to prepend to the workspace names that CTS automatically generates. CTS adds the prefix to all tasks that use the driver. By default, CTS uses the task name for the workspace name. Configuring `prefix` generates names according the `<prefix>_<task name>` format. For example, CTS generates `cts_task_firewall` when `prefix = "cts_"` for a task named `task_firewall`. | String | None |
| `tags` | Specifies tags that CTS adds to all automated workspaces when the workspace is first created or discovered. CTS adds tags workspaces it discovers when the workspace meets automation requirements. Refer to [Network drivers](/consul/docs/cts/network-drivers/terraform-cloud#remote-workspaces) for additional information. Discovered workspaces must also satisfies the `tags_allowlist` and `tags_denylist` settings. This option does not affect existing tags. Tags that were manually removed during runtime are re-tagged when CTS restarts. Compatible with Terraform Cloud and Terraform Enterprise v202108-1+ | List of strings | None |
| `tags_allowlist` | Specifies a list of tags for CTS to check Terraform Cloud workspaces for. A workspace must contain at least one of the tags for CTS to perform automation tasks in the workspace. Tags on the deny list take precedence over tags on the allow list. Compatible with Terraform Cloud and Terraform Enterprise v202108-1+.| List of strings | None |
| `tags_denylist` | Specifies a list of tags for CTS to check Terraform Cloud workspaces for. CTS does not perform automation tasks in workspaces that contain any of the tags. Tags on the deny list take precedence over tags on the allow list. Compatible with Terraform Cloud and Terraform Enterprise v202108-1+. | List of strings | None |

### `driver "terraform-cloud".required_providers` 

Map that declares the Terraform providers CTS must use across all tasks. CTS processes the requirements when preparing each task that uses the provider. The `required_providers` block contain the name of a local provider. Each local provider contains the following fields:

- `source`: Specifies the global source address for the provider.
- `version`: Specifies the required version of the provider.

Refer to [`terraform.required_providers`](/terraform/language/providers/requirements#requiring-providers) in the Terraform documentation for additional information about declaring required providers in a Terraform configuration.

### `driver "terraform-cloud".tls`

Specifies TLS connection settings so that CTS can communicate with Terraform Enterprise over HTTPS. Refer to [Interactive Terraform Enterprise Installation](/terraform/enterprise/install/interactive/installer#tls-key-amp-cert) in the Terraform Enterprise documentation for additional information.

The following table describes the parameters you can set in the `tls` block:

| Parameter | Description | Data type | Default |
| --------- | ---- | ----------- | ------- |
| `enabled` | Set to `true` to explicitly enable TLS. Providing a value for any of the TLS options also implicitly enables TLS | Boolean | `false` |
| `ca_cert` | Specifies the path to a PEM-encoded certificate authority file for verifying the authenticity of the connection to Terraform Enterprise over TLS. | String | None |
| `ca_path` | Specifies the path to a directory of PEM-encoded certificate authority files for verifying the authenticity of the connection to Terraform Enterprise over TLS. | String | None |
| `cert` | Specifies the path to a PEM-encoded client certificate file provided to Terraform Enterprise over TLS so that Terraform Enterprise can verify the authenticity of the connection from CTS. | String | None |
| `key` | Specifies the path to the PEM-encoded private key file used with the client certificate configured by `cert` for communicating with Terraform Enterprise over TLS. | String | None |
| `server_name` | Specifies the server name to use as the Server Name Indication (SNI) for Terraform Enterprise when connecting over TLS. | String | None |
| `verify` | Set to `true` to enable TLS peer verification. CTS checks the global CA chain to verify certificates returned by Terraform Enterprise. You can set the certificate with `ca_cert` or `ca_path` when Terraform Enterprise uses a self-signed certificate that has not been added to the global CA chain. Alternatively, you can disable SSL verification by setting `verify` to `false`. Disabling verification is a potential security vulnerability. | Boolean | `true` | 

#### Values

- Data type: Map
- Default: None

### `terraform_provider "<provider>"` 

Specifies the configuration options for interfacing with network infrastructure. Define a block for each provider required by the set of Terraform modules across all tasks. Each provider has its own settings. Refer to the provider documentation in the [Terraform Registry](https://registry.terraform.io/browse/providers) for details on how to configure the providers you want to use with CTS.

The `terraform_provider` block uses the same syntax and format as the Terraform configuration language's `provider` block. Refer to [Provider Configuration](/terraform/language/providers/configuration) in the Terraform documentation for additional information. 

CTS generates a Terraform variables file called `terraform.tfvars` for each Terraform workspace that references the provider. CTS writes the provider arguments configured in the CTS configuration as plain text to the variables file. Refer to [Variables](/consul/docs/cts/network-drivers/terraform-cloud#variables) for additional information about the Terraform Cloud variables. 

To exclude arguments or dynamic values from rendering to local files in plain text, use [`task_env` in addition to using dynamic configuration](#securely-configure-terraform-providers).

#### Values

- Data type: Map
- Default: None

### `terraform_provider "<provider>".task_env`

Map of key-value pairs for renaming or scoping the environment variables supported by the provider. Passing sensitive values as environment variables scopes the values to only the tasks that require the provider. Refer to [Assign task environment variables](#assign-task-environment-variables) for an example. Refer to [Secure Terraform providers configuration](/consul/docs/cts/configure#secure-terraform-providers-configuration) for instructions.

#### Values

- Data type: String
- Default: None

### `terraform_provider "<provider>".alias`

Assigns the Terraform provider configuration an alias so that you can reuse the provider configuration across multiple [`task.provider`](#task-provider) configurations. Refer to [Reuse a Terraform provider configuration](#reuse-a-erraform-provider-configuration) for an example. Refer to [`Alias`: Multiple Provider Configurations](/terraform/language/providers/configuration#alias-multiple-provider-configurations) in the Terraform documentation for additional information about the `alias` parameter.

#### Values

- Data type: String
- Default: None

## Examples

The following examples demonstrate common CTS configuration patterns.

### Driver configuration

The following example configures CTS to install and run a local Terraform CLI. It uses the `consul` backend to manage state and requires `myprovider` when applying the configuration.

```hcl
driver "terraform" {
  log         = false
  persist_log = false
  path        = ""

  backend "consul" {
    gzip = true
  }

  required_providers {
    myprovider = {
      source  = "namespace/myprovider"
      version = "1.3.0"
    }
  }
}
```

The following example configures CTS to use Terraform Cloud for infrastructure automation using a token queried from Vault:

```hcl
driver "terraform-cloud" {
hostname     = "https://app.terraform.io"
organization = "my-org"
token = "{{ with secret \"secret/my/path\" }}{{ .Data.data.foo }}{{ end }}"

workspaces {
  tags           = ["source:cts"]
  tags_allowlist = []
  tags_denylist  = []
}

required_providers {
  myprovider = {
    source  = "namespace/myprovider"
    version = "1.3.0"
    }
  }
}
```
### Task condition types

The following example configures the task to run when either the `api` or `web` service in the `default` namespace changes:

```hcl
task {
  name        = "services_condition_names_task"
  description = "execute on changes to services with names api or web"
  module      = "path/to/services-condition-module"

  condition "services" {
    names = ["api", "web"]
    datacenter = "dc1"
    namespace  = "default"
    filter     = "Service.Tags not contains \"prod\""
    cts_user_defined_meta {
      key = "value"
    }
  }
}

```

The following example configures the task to run when services prefixed with `web` in the `default` namespace change:

```hcl
task {
  name        = "services_condition_regexp_task"
  description = "execute on changes to services with names starting with web"
  providers   = ["my-provider"]
  module      = "path/to/services-condition-module"

  condition "services" {
    regexp     = "^web.*"
    datacenter = "dc1"
    namespace  = "default"
    filter     = "Service.Tags not contains \"prod\""
    cts_user_defined_meta {
      key = "value"
    }
  }
}
```

The following example configures CTS to run the task when a service prefixed with `web.` in the `default` namespace registers or de-registers with Consul:

```hcl
task {
  name        = "catalog_service_condition_task"
  description = "execute on service registrations or de-registrations with name matching 'web.*'"
  module      = "path/to/catalog-services-module"
  providers   = ["my-provider"]

  condition "catalog-services" {
    datacenter          = "dc1"
    namespace           = "default"
    regexp              = "web.*"
    use_as_module_input = true
    node_meta {
      key = "value"
    }
  }
}
```

The following example configures CTS to run the task when the value stored in `my-key` changes:

```hcl
task {
  name        = "consul_kv_condition_task"
  description = "execute on changes to Consul KV entry"
  module      = "path/to/consul-kv-module"
  providers   = ["my-provider"]

  condition "consul-kv" {
    path                = "my-key"
    recurse             = false
    datacenter          = "dc1"
    namespace           = "default"
    use_as_module_input = true
  }
}
```

The following example configures CTS to run the task every Monday using service information from the `web` and `db` services:

```hcl
task {
  name        = "scheduled_task"
  description = "execute every Monday using service information from web and db"
  module      = "path/to/module"

  condition "schedule" {
    cron = "* * * * Mon"
  }

  module_input "services" {
    names = ["web", "db"]
  }
}
```

### Module input types

The following example shows the basic structure of the `module_input` block within a task configuration:

```hcl
task {
  name     = "task_a"
  module   = "path/to/module"
  services = ["api"] // (deprecated)

  condition "<condition-type>" {
    // ...
  }

  module_input "<input-type>" {
    // ...
  }
}
```

In the following example, CTS is configured to run the task on Mondays using information from Consul services prefixed with `web.`. CTS gets the service information according to the `module_input "services"` configuration and provides the metadata to the Terraform module at `path/to/module` as inputs.

```hcl
task {
  name        = "schedule_condition_task"
  description = "execute every Monday using information from service names starting with web"
  module      = "path/to/module"

  condition "schedule" {
    cron = "* * * * Mon"
  }

  module_input "services" {
    regexp = "^web.*"
    datacenter = "dc1"
    namespace  = "default"
    filter     = "Service.Tags not contains \"prod\""
    cts_user_defined_meta {
      key = "value"
    }
  }
}
```

In the following example, CTS is configured to run the task on Mondays. The task queries datacenter `dc1` in the `default` namespace and provides the value held by the key `my-key` to the Terraform module at `path/to/module` as inputs.

```hcl
task {
  name        = "schedule_condition_task_kv"
  description = "execute every Monday using information from Consul KV entry my-key"
  module      =  "path/to/module"

  condition "schedule" {
    cron = "* * * * Mon"
  }

  module_input "consul-kv" {
    path       = "my-key"
    recurse    = false
    datacenter = "dc1"
    namespace  = "default"
  }
}
```

### Terraform providers

The following example configuration configures CTS to use the [AWS Terraform provider](https://registry.terraform.io/providers/hashicorp/aws/latest/docs) as an example.

```hcl
driver "terraform" {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "3.33.0"
    }
  }
}

terraform_provider "aws" {
  // Configuration options
  region = "us-east-1"
}

task {
  module    = "path/to/module"
  providers = ["aws"]
  condition "services" {
    names = ["web", "api"]
  }
}
```

### Assign task environment variables

You can assign sensitive data to environment variables and pass them to the provider in the CTS configuration file that CTS would otherwise write as plain text in the `terraform.tfvars` file it generates for the Terraform Cloud workspace. For example, export an access token:

```shell-session
$ export FOO_TOKEN = "<token value>"
```

Then, reference the token in the [`task_env`](#terraform-provider-provider-task_env) parameter to dynamically assign the task's environment from the shell `env`, Consul KV, or Vault:  

```hcl
terraform_provider "foo" {

  task_env {
    "FOO_TOKEN" = "{{ env \"CTS_FOO_TOKEN\" }}"
  }
}
```

### Reuse a Terraform provider configuration

You can define multiple provider blocks with the same provider name and set the `alias` to a unique value across a given provider. Refer to [`Alias`: Multiple Provider Configurations](/terraform/language/providers/configuration#alias-multiple-provider-configurations) in the Terraform documentation for additional information about the `alias` parameter.

The following example configuration defines two similar tasks that execute the same module with different instances of the AWS provider.

```hcl
terraform_provider "aws" {
  alias   = "a"
  profile = "team-a"
  task_env {
    "AWS_ACCESS_KEY_ID" = "{{ env \"CTS_AWS_ACCESS_KEY_ID_A\" }}"
  }
}

terraform_provider "aws" {
  alias   = "b"
  profile = "team-b"
  task_env {
    "AWS_ACCESS_KEY_ID" = "{{ env \"CTS_AWS_ACCESS_KEY_ID_B\" }}"
  }
}

terraform_provider "dns" {
  // ...
}

task {
  name      = "task-a"
  module    = "org/module"
  providers = ["aws.a", "dns"]
  // ...
}

task {
  name      = "task-b"
  module    = "org/module"
  providers = ["aws.b", "dns"]
  // ...
}
```

### Terraform variable definition file

The following example sets two variables in a Terraform variable definition file:

<CodeBlockConfig filename="example.tfvars">

```hcl
address_group = "consul-services"
tags = [
  "consul-terraform-sync",
  "terraform"
]
```

</CodeBlockConfig>
