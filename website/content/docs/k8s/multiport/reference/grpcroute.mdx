---
layout: docs
page_title: GRPCRoute resource configuration reference
description: The GRPCRoute resource CRD configures L7 GRPC traffic behavior within the service mesh. GRPCRoute is a GAMMA resource that requires the v2 catalog API. Learn how to configure the GRPCRoute CRD with specifications and example configurations.
---

# GRPCRoute resource configuration reference

This page provides reference information for the GRPCRoute resource, which defines L7 GRPC traffic within the service mesh.

This custom resource definition (CRD) describes a GAMMA resource that requires the [v2 catalog API](/consul/docs/architecture/catalog/v2). It is not compatible with the [v1 catalog API](/consul/docs/architecture/catalog/v1). For more information about GAMMA resources, refer to the [Kubernetes Gateway API documentation](https://gateway-api.sigs.k8s.io/concepts/gamma/).

## Configuration model

The following list outlines field hierarchy, language-specific data types, and requirements in a GRPCRoute CRD. Click on a property name to view additional details, including default values.

- [`elem_a`](#elema): data type | default
- [`elem_b`](#elemb): data type | default
- [`spec`](#elemb): data type | default
- [`elem_ba`](#elembelemba): data type | default
- [`elem_baa`](#elembelembaelembaa): data type | default
- [`elem_baaa`](#elembelembaelembaa): data type | default
- [`elem_baab`](#elembelembaelembaa): data type | default
- [`elem_baac`](#elembelembaelembaa): data type | default
- [`element_bab`](#elembelembaelembab): data type | default

## Complete configuration

When every field is defined, a GRPCRoute resource CRD has the following form:

```yaml
apiVersion: mesh.consul.hashicorp.com/v2beta1        # required
kind: GRPCRoute                                      # required
metadata:
  name:
  namespace:
spec:
  parentRefs:
    port:
    ref:
      name:
      section:
      tenancy:
        namespace:
        partition:
        peerName:
  rules:
    backendRefs:
      backendRef:
        datacenter:
        port:
        ref:
          name:
          section:
          tenancy:
            namespace:
            partition:
            peerName:
          type:
            group:
            groupVersion:
            kind:
      filters:
        requestHeaderModifier:
        responseHeaderModifier:
        urlRewrite:
          pathPrefix:
      weight:
    filters:
      requestHeaderModifier:
      responseHeaderModifier:                        
      urlRewrite:
        pathPrefix:
    matches:
      headers:
        name:
        type:
        value:
    method:
      method:
      service:
      type:
    retries:
      number:
        value: 
      onConditions:
      onConnectFailure: false
      onStatusCodes: [400, 404]
    timeouts:
      idle:
        nanos:
        seconds:
      request:
        nanos:
        seconds:
```

## Specification

This section provides details about the fields you can configure in the GRPCRoute CRD.

### `apiVersion`

Specifies the version of the Consul API for integrating with Kubernetes. The value must be `mesh.consul.hashicorp.com/v2beta1`.

#### Values

- Default: None
- This field is required.
- String value that must be set to `mesh.consul.hashicorp.com/v2beta1`.

### `kind`

Specifies the type of CRD to implement. Must be set to `GRPCRoute`.

#### Values

- Default: None
- This field is required.
- Data type: String value that must be set to `GRPCRoute`.

## `metadata`

Map that contains an arbitrary name for the CRD and the namespace it applies to.

#### Values

- Default: None
- Data type: Map

### `metadata.name`

Specifies a name for the CRD. The name is metadata that you can use to reference the resource when performing Consul operations, such as using the `consul resource` command. Refer to [`consul resource`](/consul/docs/k8s/connect/multiport/reference/resource-command) for more information.

#### Values

- Default: None
- This field is required.
- Data type: String

### `metadata.namespace` <EnterpriseAlert inline />

Specifies the namespace that the service resolver applies to. Refer to [namespaces](/consul/docs/enterprise/namespaces) for more information.

#### Values

- Default: None
- Data type: String

### `spec`

Map that contains the details about the `GRPCRoute` CRD. The `apiVersion`, `kind`, and `metadata` fields are siblings of the spec field. All other configurations are children.

When using this CRD, the `spec` field must align with GAMMAs resource. Refer to [GRPCRoute in the Kubernetes documentation](https://gateway-api.sigs.k8s.io/references/spec/#gateway.networking.k8s.io/v1alpha2.GRPCRoute).

#### Values

- Default: None
- This field is required.
- Data type: Map

### `spec.parentRefs`

References the resources (usually Services)
                  that a Route wants to be attached to. \n It is invalid to reference
                  an identical parent more than once. It is valid to reference multiple
                  distinct sections within the same parent resource.

#### Values

- Default: None
- This field is required.
- Data type: Map

### `spec.parentRefs.port`

For east/west this is the name of the Consul Service port to direct traffic to or empty to imply all.

#### Values

- Default: None
- Data type: String

### `spec.parentRefs.ref`

For east/west configuration, this should point to a Service.

#### Values

- Default: None
- Data type: Map

### `spec.parentRefs.ref.name`

Name is the user-given name of the resource
                            (e.g. the "billing" service).

#### Values

- Default: None
- Data type: String

### `spec.parentRefs.ref.section`

Section identifies which part of the resource the condition relates to.

#### Values

- Default: None
- Data type: String

### `spec.parentRefs.ref.tenancy`

Tenancy identifies the tenancy units (i.e. partition, namespace) in which the resource resides.

#### Values

- Default: None
- Data type: Map containing the following parameters:

  | Parameter     | Description                                                          | Data type | Default  |
  | :------------ | :------------------------------------------------------------------- | :-------- | :------- |
  | `namespace`   | Identifies the namespace where the resource applies.                 | String    | None     |
  | `partition`   | Identifies the admin partition where the resource applies.           | String    | None     |
  | `peerName`    | Identifies the name of a cluster peer the resource is imported from. | String    | None     |

### `spec.rules`

Rules are a list of GRPC matchers, filters and actions.

#### Values

- Default: None
- Data type: Map

### `spec.rules.backendRefs`

BackendRefs defines the backend(s) where matching requests should be sent. Failure behavior here depends on how many BackendRefs are specified and how many are invalid. If all entries in BackendRefs are invalid, and there are also no filters specified in this route rule, all traffic which matches this rule MUST receive a 500 status code. See the GRPCBackendRef definition for the rules about what makes a single GRPCBackendRef invalid. When a GRPCBackendRef is invalid, 500 status codes MUST be returned for requests that would have otherwise been routed to an invalid backend.

If multiple backends are specified, and some are invalid, the proportion of requests that would otherwise have been routed to an invalid backend MUST receive a 500 status code. For example, if two backends are specified with equal weights, and one is invalid, 50 percent of traffic must receive a 500. Implementations may choose how that 50 percent is determined.

#### Values

- Default: None
- Data type: Map

### `spec.rules.backendRefs.backendRef`

Defines an individual backend where matching requests should be sent.

#### Values

- Default: None
- Data type: Map

### `spec.rules.backendRefs.backendRef.datacenter`

Specifies the name of the datacenter

#### Values

- Default: None
- Data type: String

### `spec.rules.backendRefs.backendRef.port`

For east/west this is the name of the Consul Service port to direct traffic to or empty to imply using the same value as the parent ref.

#### Values

- Default: None
- Data type: String

### `spec.rules.backendRefs.backendRef.ref`

For east/west configuration, this should point to a Service.

#### Values

- Default: None
- Data type: Map

### `spec.rules.backendRefs.backendRef.ref.name`

Name is the user-given name of the resource(e.g. the "billing" service).

#### Values

- Default: None
- Data type: String

### `spec.rules.backendRefs.backendRef.ref.section`

Section identifies which part of the resource the condition relates to.

#### Values

- Default: None
- Data type: String

### `spec.rules.backendRefs.backendRef.ref.tenancy`

Tenancy identifies the tenancy units (i.e. partition, namespace) where the rule applies.

#### Values

- Default: None
- Data type: Map containing the following parameters:

  | Parameter     | Description                                                          | Data type | Default  |
  | :------------ | :------------------------------------------------------------------- | :-------- | :------- |
  | `namespace`   | Identifies the namespace where the resource applies.                 | String    | None     |
  | `partition`   | Identifies the admin partition where the resource applies.           | String    | None     |
  | `peerName`    | Identifies the name of a cluster peer the resource is imported from. | String    | None     |

### `spec.rules.backendRefs.backendRef.ref.type`

Type identifies the resource's type.

#### Values

- Default: None
- Data type: Map containing the following parameters:

  | Parameter     | Description                                                          | Data type | Default  |
  | :------------ | :------------------------------------------------------------------- | :-------- | :------- |
  | `group`   | Describes the area of functionality to which this resource type relates. | String    | None     |
  | `groupVersion` | Increments when sweeping or backward-incompatible changes are made to the group's resource types. | String (in code, should be int based on desc.)   | None     |
  | `kind`    | Iidentifies the specific resource type within the group.                 | String    | None     |

### `spec.rules.backendRefs.filters`

Filters defined at this level should be executed if and only if the request is being forwarded to the backend defined here.

#### Values

- Default: None
- Data type: Map

### `spec.rules.backendRefs.filters.requestHeaderModifier`

Specifies a set of HTTP-specific header modification rules applied to requests routed with the GRPCRoute resource.

#### Values

- Default: None
- Values: Object containing one or more fields that define header modification rules:
  - `add`: Map of one or more key-value pairs.
  - `set`: Map of one or more key-value pairs.
  - `remove`: Map of one or more key-value pairs.

The following table describes how to configure values for request headers:

| Rule | Description | Type |
| --- 	    | ---	       | ---         |
| `add` | Defines a set of key-value pairs to add to the header. Use header names as the keys. Header names are not case-sensitive. If header values with the same name already exist, the value is appended and Consul applies both headers. You can [use variable placeholders](#use-variable-placeholders). | map of strings |
| `set` | Defines a set of key-value pairs to add to the request header or to replace existing header values with. Use header names as the keys. Header names are not case-sensitive. If header values with the same names already exist, Consul replaces the header values. You can [use variable placeholders](#use-variable-placeholders). | map of strings |
| `remove` | Defines a list of headers to remove. Consul removes only headers containing exact matches. Header names are not case-sensitive. | list of strings |

### `spec.rules.backendRefs.filters.responseHeaderModifier`

Specifies a set of HTTP-specific header modification rules applied to responses routed with the GRPCRoute resource.

#### Values

- Default: None
- Values: Object containing one or more fields that define header modification rules:
  - `add`: Map of one or more key-value pairs.
  - `set`: Map of one or more key-value pairs.
  - `remove`: Map of one or more key-value pairs.

The following table describes how to configure values for request headers:

| Rule | Description | Type |
| --- 	    | ---	       | ---         |
| `add` | Defines a set of key-value pairs to add to the header. Use header names as the keys. Header names are not case-sensitive. If header values with the same name already exist, the value is appended and Consul applies both headers. You can [use variable placeholders](#use-variable-placeholders). | map of strings |
| `set` | Defines a set of key-value pairs to add to the request header or to replace existing header values with. Use header names as the keys. Header names are not case-sensitive. If header values with the same names already exist, Consul replaces the header values. You can [use variable placeholders](#use-variable-placeholders). | map of strings |
| `remove` | Defines a list of headers to remove. Consul removes only headers containing exact matches. Header names are not case-sensitive. | list of strings |

### `spec.rules.backendRefs.filters.urlRewrite`

URLRewrite defines a schema for a filter that modifies a request during forwarding.

#### Values

- Default: None
- Data type: Map containing the following parameter:

  | Parameter     | Description                                                                                        | Data type | Default |
  | :------------ | :------------------------------------------------------------------------------------------------- | --------- | ------- |
  | `pathPrefix` | Specifies the number of random healthy hosts from which to select the one with the least requests.  | String    | None    |

### `spec.rules.backendRefs.weight`

Weight specifies the proportion of requests forwarded to the referenced backend. This is computed as weight/(sum of all weights in this BackendRefs list). For non-zero values, there may be some epsilon from the exact proportion defined here depending on the precision an implementation supports. Weight is not a percentage and the sum of weights does not need to equal 100. If only one backend is specified and it has a weight greater than 0, 100% of the traffic is forwarded to that backend. If weight is set to 0, no traffic should be forwarded for this entry. If unspecified, weight defaults to 1.

#### Values

- Default: `1`
- Data type: Integer

### `spec.rules.filters`

Weight specifies the proportion of requests forwarded to the referenced backend. This is computed as weight/(sum of all weights in this BackendRefs list). For non-zero values, there may be some epsilon from the exact proportion defined here depending on the precision an implementation supports. Weight is not a percentage and the sum of weights does not need to equal 100. If only one backend is specified and it has a weight greater than 0, 100% of the traffic is forwarded to that backend. If weight is set to 0, no traffic should be forwarded for this entry. If unspecified, weight defaults to 1.

#### Values

- Default: None
- Data type: Map

### `spec.rules.filters.requestHeaderModifier`

Specifies a set of HTTP-specific header modification rules applied to requests routed with the GRPCRoute resource.

#### Values

- Default: None
- Values: Object containing one or more fields that define header modification rules:
  - `add`: Map of one or more key-value pairs.
  - `set`: Map of one or more key-value pairs.
  - `remove`: Map of one or more key-value pairs.

The following table describes how to configure values for request headers:

| Rule | Description | Type |
| --- 	    | ---	       | ---         |
| `add` | Defines a set of key-value pairs to add to the header. Use header names as the keys. Header names are not case-sensitive. If header values with the same name already exist, the value is appended and Consul applies both headers. You can [use variable placeholders](#use-variable-placeholders). | map of strings |
| `set` | Defines a set of key-value pairs to add to the request header or to replace existing header values with. Use header names as the keys. Header names are not case-sensitive. If header values with the same names already exist, Consul replaces the header values. You can [use variable placeholders](#use-variable-placeholders). | map of strings |
| `remove` | Defines a list of headers to remove. Consul removes only headers containing exact matches. Header names are not case-sensitive. | list of strings |

### `spec.rules.filters.responseHeaderModifier`

Specifies a set of HTTP-specific header modification rules applied to responses routed with the GRPCRoute resource.

#### Values

- Default: None
- Values: Object containing one or more fields that define header modification rules:
  - `add`: Map of one or more key-value pairs.
  - `set`: Map of one or more key-value pairs.
  - `remove`: Map of one or more key-value pairs.

The following table describes how to configure values for request headers:

| Rule | Description | Type |
| --- 	    | ---	       | ---         |
| `add` | Defines a set of key-value pairs to add to the header. Use header names as the keys. Header names are not case-sensitive. If header values with the same name already exist, the value is appended and Consul applies both headers. You can [use variable placeholders](#use-variable-placeholders). | map of strings |
| `set` | Defines a set of key-value pairs to add to the request header or to replace existing header values with. Use header names as the keys. Header names are not case-sensitive. If header values with the same names already exist, Consul replaces the header values. You can [use variable placeholders](#use-variable-placeholders). | map of strings |
| `remove` | Defines a list of headers to remove. Consul removes only headers containing exact matches. Header names are not case-sensitive. | list of strings |

### `spec.rules.filters.urlRewrite`

URLRewrite defines a schema for a filter that modifies a request during forwarding.

#### Values

- Default: None
- Data type: Map containing the following parameter:

  | Parameter     | Description                                                                                        | Data type | Default |
  | :------------ | :------------------------------------------------------------------------------------------------- | --------- | ------- |
  | `pathPrefix` | Specifies the number of random healthy hosts from which to select the one with the least requests.  | String    | None    |

### `spec.rules.matches`

Specifies matching rules

#### Values

- Default: None
- Data type: Map

### `spec.rules.matches.headers`

Headers specifies gRPC request header matchers. Multiple match values are ANDed together, meaning, a request MUST match all the specified headers to select the route.

#### Values

- Default: None
- Data type: Map

### `spec.rules.matches.headers.name`

Name of the header to match on.

#### Values

- Default: None
- Data type: String

### `spec.rules.matches.headers.type`

HeaderMatchType specifies the semantics of how HTTP header values should be compared. Valid HeaderMatchType values, along with their conformance levels, are: \n Note that values may be added to this enum, implementations must ensure that unknown values will not cause a crash. Unknown values here must result in the implementation setting the Accepted Condition for the Route to status: False, with a Reason of UnsupportedValue.

#### Values

- Default: None
- Data type: String that should match one of the following values:

  - `HEADER_MATCH_TYPE_UNSPECIFIED`
  - `HEADER_MATCH_TYPE_EXACT`
  - `HEADER_MATCH_TYPE_REGEX`
  - `HEADER_MATCH_TYPE_PRESENT`
  - `HEADER_MATCH_TYPE_PREFIX`
  - `HEADER_MATCH_TYPE_SUFFIX`

### `spec.rules.matches.headers.value`

Specifies the value of the header to match.

#### Values

- Default: None
- Data type: String

### `spec.rules.matches.method`

Specifies a gRPC request service/method matcher. If this field is not specified, all services and methods will match.

#### Values

- Default: None
- Data type: Map

### `spec.rules.matches.method.method`

Value of the method to match against. If left empty or omitted, will match all services. At least one of Service and Method MUST be a non-empty string.

#### Values

- Default: None
- Data type: String

### `spec.rules.matches.method.service`

Value of the service to match against. If left empty or omitted, will match any service. At least one of Service and Method MUST be a non-empty string.

#### Values

- Default: None
- Data type: String

### `spec.rules.matches.method.type`

Type specifies how to match against the service and/or method.

#### Values

- Default: None
- Data type:  String that should match one of the following values:

  - `GRPC_METHOD_MATCH_TYPE_UNSPECIFIED`
  - `GRPC_METHOD_MATCH_TYPE_EXACT`
  - `GRPC_METHOD_MATCH_TYPE_REGEX`

### `spec.rules.retries`

Specifies retry logic for the resource.

#### Values

- Default: None
- Data type: Map

### `spec.rules.retries.number`

Specifies retry logic for the resource.

#### Values

- Default: None
- Data type: Map that contains the following parameter:

  | Parameter | Description                                  | Data type | Default |
  | :-------- | :------------------------------------------- | --------- | ------- |
  | `value`   | Specifies the number of retries to attempt.  | Integer   | None    |

### `spec.rules.retries.onConditions`

RetryOn allows setting envoy specific conditions when a request should be automatically retried.

#### Values

- Default: None
- Data type: Array of strings

### `spec.rules.retries.onConnnectFailure`

Allows for connection failure errors to trigger a retry.

#### Values

- Default: `false`
- Data type: Boolean

### `spec.rules.retries.onStatusCodes`

Flat list of http response status codes that are eligible for retry. This again should be feasible in any reasonable proxy.

#### Values

- Default: None
- Data type: Array of integers

### `spec.rules.timeouts`

Specifies timeout logic for the resource.

#### Values

- Default: None
- Data type: Map

### `spec.rules.timeouts.idle`

Specifies the total amount of time permitted for the request stream to be idle.

#### Values

- Default: None
- Data type: Map that can contain the following parameters:

  | Parameter | Description                                                      | Data type | Default |
  | :-------- | :--------------------------------------------------------------- | --------- | ------- |
  | `nanos`   | Specifies the number of nanoseconds before triggering a timeout. | Integer   | None    |
  | `seconds` | Specifies the number of seconds before triggering a timeout.     | Integer   | None    |

### `spec.rules.timeouts.request`

Specifies the total amount of time permitted for the entire downstream request and retries to be processed before triggering a timeout.

#### Values

- Default: None
- Data type: Map that can contain the following parameters:

  | Parameter | Description                                                      | Data type | Default |
  | :-------- | :--------------------------------------------------------------- | --------- | ------- |
  | `nanos`   | Specifies the number of nanoseconds before triggering a timeout. | Integer   | None    |
  | `seconds` | Specifies the number of seconds before triggering a timeout.     | Integer   | None    |

## Examples

If you have more than one example to show, create an Examples section (general block) and introduce the examples per the style guide.

### Split service traffic between two ports

The following configuration splits traffic for the `api` service. GRPC traffic for services registered to the Consul catalog that are available at the `api-workload` port is split so that 50% of the traffic routes to the service at the `api-workload` port and 50% routes to the service at the `admin-workload` port.

```yaml
apiVersion: mesh.consul.hashicorp.com/v2beta1
kind: GRPCRoute
metadata:
  name: api-split
  namespace: default
spec:
  parentRefs:
    - ref:
        type: 
          group: catalog
          groupVersion: v2beta1
          kind: Service
        name: api
      # Note that right now, we must target the workload port,
      # not the service port. This is likely to change in 1.18+.
      port: "api-workload"
  rules:
    - backendRefs:
      - backendRef:
          ref: 
            type:
              group: catalog
              groupVersion: v2beta1
              kind: Service
            name: api
          # Note that right now, we must target the workload port,
          # not the service port. This is likely to change in 1.18+.
          port: "api-workload"
        weight: 50
      - backendRef:
          ref: 
            type:
              group: catalog
              groupVersion: v2beta1
              kind: Service
            name: api
          # Note that right now, we must target the workload port,
          # not the service port. This is likely to change in 1.18+.
          port: "admin-workload"
        weight: 50
```
