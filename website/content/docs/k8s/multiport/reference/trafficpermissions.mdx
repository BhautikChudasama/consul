---
layout: docs
page_title: TrafficPermissions resource configuration reference
description: The TrafficPermissions CRD defines rules for allowing and denying traffic between services within the service mesh. Learn how to configure traffic permissions for the v2 catalog to authorize service-to-service communication in a network with zero-trust security.
---

# TrafficPermissions configuration reference

This page provides reference information for the TrafficPermissions resource, which authorizes east/west traffic between services within the service mesh. The traffic permissions CRD replaces the service intentions CRD when using the v2 catalog API. Refer to [changes to Consul's existing architecture](/consul/docs/architecture/catalog/v2#changes-to-consul-s-existing-architecture) for more information.

This custom resource definition (CRD) describes a GAMMA resource that requires the [v2 catalog API](/consul/docs/architecture/catalog/v2). It is not compatible with the [v1 catalog API](/consul/docs/architecture/catalog/v1). For more information about GAMMA resources, refer to the [Kubernetes Gateway API documentation](https://gateway-api.sigs.k8s.io/concepts/gamma/).

## Configuration model

The following list outlines field hierarchy, language-specific data types, and requirements in a TrafficPermissions CRD. Click on a property name to view additional details, including default values.

<Tabs>

<Tab heading="YAML" group="yaml">

- [`apiVersion`](#apiversion): string | required | must be set to `mesh.consul.hashicorp.com/v2beta1`
- [`kind`](#kind): string | required | must be set to `TrafficPermissions`
- [`metadata`](#metadata): object | required
  - [`name`](#metadata-name): string | required
  - [`namespace`](#metadata-namespace): string | optional <EnterpriseAlert inline />
- [`spec`](#spec): object | required
  - [`destination`](#spec-destination):
    - [`identityName`](#spec-destination-identityname):
  - [`action`](#spec-action):
  - [`permissions`](#spec-permissions):
    - [`sources`](#spec-permissions-sources):
      - [`namespace`](#spec-permissions-sources):
    - [`identityName`](#spec-permissions-identityname):
      - [`destinationRules`](#spec-permissions-identityname-destinationrules):
        - [`pathExact`](#spec-permissions-identityname-destinationrules):
      - [`methods`](#spec-permissions-identityname-methods): array of strings
    - [`portNames`](#spec-permissions-portnames): array of strings

</Tab>
</Tabs>

## Complete configuration

The [configuration model](#configuration-model) provides an overview of configurable fields and links to each field's specifications. The complete configuration provides the same basic structure, including field hierarchy and data types, in a code block that you can copy and paste into your preferred coding environment.

When every field is defined, a TrafficPermissions CRD has the following form:

```yaml
apiVersion: auth.consul.hashicorp.com/v2beta1    # required
kind: TrafficPermissions                         # required
metadata:
  name: <permissionsResourceName>
  namespace: <default>
spec:
  destination:
    identityName: <permissionsDestinationService>
  action: allow
  permissions:
    - sources:
        - namespace: <originNamespace>
    identityName: <permissionsOriginService>
      destinationRules:
        - pathExact: <path/to>
      methods: ["GET", "POST"]
    portNames: ["<servicePortName>"]
```

## Specification
This section provides details about the fields you can configure in the ProxyConfiguration custom resource definition (CRD).

### `apiVersion`

Specifies the version of the Consul API for integrating with Kubernetes. The value must be `mesh.consul.hashicorp.com/v2beta1`.

#### Values

- Default: None
- This field is required.
- String value that must be set to `mesh.consul.hashicorp.com/v2beta1`.

### `kind`

Specifies the type of CRD to implement. Must be set to `TrafficPermissions`.

#### Values

- Default: None
- This field is required.
- Data type: String value that must be set to `TrafficPermissions`.

### `metadata`

Map that contains an arbitrary name for the CRD and the namespace it applies to.

#### Values

- Default: None
- Data type: Map

### `metadata.name`

Specifies a name for the CRD. The name is metadata that you can use to reference the resource when performing Consul operations, such as using the `consul resource` command. Refer to [`consul resource`](/consul/docs/k8s/connect/multiport/reference/resource-command) for more information.

#### Values

- Default: None
- This field is required.
- Data type: String

### `metadata.namespace` <EnterpriseAlert inline />

Specifies the namespace that the service resolver applies to. Refer to [namespaces](/consul/docs/enterprise/namespaces) for more information.

#### Values

- Default: None
- Data type: String

### `spec`

Map that contains the details about the `TrafficPermissions` CRD. The `apiVersion`, `kind`, and `metadata` fields are siblings of the spec field. All other configurations are children.

#### Values

- Default: None
- This field is required.
- Data type: Map

## Examples

The following examples demonstrate common TrafficPermissions CRD configuration patterns for specific use cases.

### Deny traffic between services

The following example configures traffic permissions to deny traffic when the `web` service makes a request to the `api` service on the `admin` port.

```yaml
apiVersion: auth.consul.hashicorp.com/v2beta1
kind: TrafficPermissions
metadata:
  name: web-to-api-port-deny
spec:
  destination:
    identityName: api
  action: deny
  permissions:
    - sources:
        - identityName: web
      destinationRules:
        - portNames: ["admin"]
```
