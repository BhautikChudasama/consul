---
layout: docs
page_title: Cluster peering best practices 
description: >- 
  Cluster peering connections in Consul interact with mesh gateways, sidecar proxies, exported services, and ACLs. Learn about the  requirements and best practices for these components.
---

# Cluster peering best practices

This page describes recommendations and best practices when using cluster peering connections between datacenters in your Consul deployments. To learn more about Consul's cluster peering feature, refer to [cluster peering overview](/consul/docs/connect/cluster-peering).

## Requirements

Your Consul environment must meet the following prerequisites:

- Consul v1.14 or higher.
- When cluster peering connections use non-default admin partitions, the clusters require an Enterprise license.
- When the service mesh is enabled, a local Consul agent is required to manage mesh gateway configurations.

Consul's default configuration supports cluster peering connections directly between clusters. In production environments, we recommend using mesh gateways to securely route service mesh traffic between partitions with cluster peering connections. When Consul's service mesh is not enabled, service discovery between peered clusters is considered secure without mesh gateways. Refer to [cluster peering overview](/consul/docs/conect/cluster-peering#compared-with-wan-federation) for more information about the role mesh gateways play in securing traffic between clusters.

## Best practices

We suggest the following best practices for Consul cluster peering connections.

- When you generate peering tokens, use the following naming convention: `<remote-dc-name>-<remote-partition-name>`.
  - For example, the instructions to [create a cluster peering connection](/consul/docs/connect/cluster-peering/usage) begin by generating a peering token in `dc1` that assigns the name `dc2-default` to the peer cluster. As a result, commands and configurations use `Peer: "dc2-default"` to refer to the remote cluster.
  - This naming convention simplifies the creation and usage of sameness groups. Because a separate peering token is exchanged for each peered cluster in the group and each cluster requires a configuration entry that defines the group from its perspective, a uniform naming convention for cluster peers lowers the number of modifications each configuration entry requires.
- Use mesh gateways to secure east-west service mesh traffic between peered clusters in production environments.
- Delete peering tokens after you terminate cluster peering connections. Unmanaged token sprawl may negatively impact the security of a Consul deployment operating in a production environment.

## Mesh gateway recommendations

When cluster peering through mesh gateways, consider the following deployment recommendaitons.

- You must register a mesh gateway as a Consul service before you can export services to peers in other regions or cloud providers.
- Register the mesh gateway in the same Consul admin partition as the exported services and their `exported-services` configuration entry.
- Define the `Proxy.Config` block in the mesh gateway configuration using opaque parameters compatible with your proxy. Refer to the [Gateway options](/consul/docs/connect/proxies/envoy#gateway-options) and [Escape-hatch Overrides](/consul/docs/connect/proxies/envoy#escape-hatch-overrides) documentation for additional Envoy proxy configuration information.

### Mesh gateway modes

By default, cluster peering connections use mesh gateways in [remote mode](/consul/docs/connect/gateways/mesh-gateway/service-to-service-traffic-wan-datacenters#remote). The `none` mode is invalid for mesh gateways with cluster peering connections.

Depending on your network's requirements, consider the following recommendations for setting a datacenter's mesh gateway mode:

- For mesh gateways that connect peered clusters, set the `mode` as either `remote` or `local`.
- To use the `local` mesh gateway mode, you must register a mesh gateway in the importing cluster.

Refer to [mesh gateway modes](/consul/docs/connect/gateways/mesh-gateway#modes) for more information.

## Sidecar proxy recommendations

You must configure the Envoy proxies that function as sidecars in your service mesh in order to properly route traffic to peers. Sidecar proxy behavior is configured in a [service definition](/consul/docs/services/usage/define-services).

- Configure the `proxy.upstreams` parameters to route traffic to the correct service, namespace, and peer. Refer to the [`upstreams`](/consul/docs/connect/proxies/proxy-config-reference#upstream-configuration-reference) documentation for details.
- The `proxy.upstreams.destination_name` parameter is always required.
- The `proxy.upstreams.destination_peer` parameter must be configured to enable cross-cluster traffic.
- The `proxy.upstream.destination_namespace` configuration is only necessary if the destination service is in a non-default namespace.

## ACL recommendations

When ACLs are enabled, add tokens to grant the following permissions.

- Grant `service:write` permissions to services that define mesh gateways in their server definition.
- Grant `service:read` permissions for all services on the partition.
- Grant `mesh:write` permissions to the mesh gateways that participate in cluster peering connections. This permission allows a leaf certificate to be issued for mesh gateways to terminate TLS sessions for HTTP requests.