---
layout: docs
page_title: Link east/west network segments on virtual machines (VMs)
description: >-
  This topic provides an overview of linking segments of your service mesh in an east/west direction on virtual machines (VMs). You can extend your service mesh across regions, runtimes, and cloud providers with cluster peering or WAN federation.
---

# Link east/west network segments on virtual machines (VMs)

This topic provides an overview of the strategies and processes for linking defined segments of your service mesh to extend east/west operations across cloud regions, runtimes, and platforms when running the Consul binary on VMs. Linking network segments into an extended service mesh enables advanced strategies for deploying and monitoring service operations in your network.

For more information about how to divide your network, including the difference between deployment strategies enabled by methods such as WAN federation and cluster peering, refer to [segment network](/consul/docs/segment/vm).

## Introduction

Consul supports two general strategies for extending east/west service mesh traffic across your network:

- Cluster peering
- Wide Area Network (WAN) federation

Consul community edition supports basic cluster peering and federation scenarios. Implementing advanced scenarios such as federated network areas and cluster peering between multiple admin partitions in datacenters require Consul Enterprise. Refer to [Consul Enterprise](consul/docs/enterprise) for more information.

## Workflows

Each strategy for extending your network has a distinct workflow to establish and verify traffic across datacenters in your service mesh. In production environments, we recommend you also [secure service mesh communication with mesh gateways](/consul/docs/link/mesh-gateway).

### Cluster peering

The workflow to establish a cluster peering connection consists of the following steps:

1. Create a peering token in one cluster.
1. Use the peering token to establish peering with a second cluster.
1. Export services between clusters.
1. Create intentions to authorize services for peers.

### WAN federation

The workflow to enable WAN federation consists of the following steps:

1. Deploy a primary datacenter.
1. Distribute certificates and configurations to secondary datacenters.
1. Join additional datacenters to a WAN gossip pool.
1. Verify members of WAN gossip pool.

### Federated network areas

The workflow to federate network areas consists of the following steps:

1. Create network areas.
1. Join datacenters in WAN gossip pool.
1. Verify members of WAN gossip pool.

### Secure communication with mesh gateways

In production environments, we recommend deploying mesh gateways to further secure communication between datacenters deployed to different cloud regions or platforms. The workflow to deploy mesh gateways between each segment of your network consists of the following steps:

1. Create a mesh gateway and register it with Consul.
1. Configure the mesh gateway mode for the datacenter.
1. Declare the mesh gateway as an explicit upstream for the datacenter's proxies.

When configuring cluster peering connections on virtual machines, you must also configure ACLs between mesh gateways. This step is required for cluster peering connections between mesh gateways, but is not required for WAN federation through mesh gateways.

## Guidance

The following resources are available to help you extend your service mesh in an east/west direction by linking segments of your network.

### Cluster peering on VMs usage documentation

Refer to the following pages for guidance about using cluster peering with Consul on Kubernetes:

- [Establish cluster peering connections on VMs](/consul/docs/link/cluster-peering/establish/vm)
- [Manage cluster peering connections on VMs](/consul/docs/link/cluster-peering/manage/vms)

### WAN federation on Kubernetes

Refer to the following pages for guidance about using WAN federation with Consul on Kubernetes:

- [WAN federation between VMs](/consul/docs/link/wan-federation/vm)
- [WAN federation between virtual machines and Kubernetes clusters](/consul/docs/link/wan-federation/k8s-vm)

### Reference documentation

For reference material related to the processes for extending your service mesh by linking segments of your network, refer to the following pages:

- [CLI reference: `consul join` command](/consul/commands/join)
- [CLI reference: `consul operator area` command](/consul/commands/operator/area)
- [CLI reference: `peering` command](/consul/commands/peering)
- [HTTP API reference: `/operator/area` endpoint](/consul/api-docs/operator/area)
- [HTTP API reference: `/peering` endpoint](/consul/api-docs/peering)
- [Mesh gateway configuration reference](/consul/docs/reference/proxy/connect-proxy)
- [Proxy defaults configuration reference](/consul/docs/reference/config-entry/proxy-defaults)

### Constraints, limitations, and troubleshooting

If you experience errors when linking segments of your network, refer to the following list of technical constraints.

- Consul does not support deployments that use WAN federation and cluster peering simultaneously.
- The Consul UI does not support the creation of cluster peering connections, WAN-federated datacenters, federated network areas, or mesh gateways. A dedicated user interface to view, create, and manage cluster peering connections is available through [HCP Consul Central](/hcp/docs/consul/monitor/consul-central/network-views#cluster-peering).