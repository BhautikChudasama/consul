---
layout: docs
page_title: Specify Terraform providers
description: Learn how to configure Terraform providers in the CTS configuration file. 
---

# Specify Terraform providers

This topic describes how to include and configure the `terraform_providers` you want to run in you Consul-Terraform-Sync (CTS) configuration file. 

## Overview

Terraform providers are plug-ins for Terraform that interface with services, cloud providers, and other APIs. Refer to [Providers](/terraform/language/providers) in the Terraform documentation to learn more about providers.

In the CTS, providers understand API interactions and exposing resources for an infrastructure type. Refer to [Network infrastructure automation overview](/consul/docs/cts) for additional information.

You can specify which providers to CTS must download and install by configuring the `driver.terraform` block. Refer to [Configure the Terraform network driver]() or [Configure the Terraform Cloud network driver]() for instructions. 

To include the providers in your configuration, add and configure the [`terraform_provider` block](/consul/docs/reference/cts#terraform-provider). You also dynamically loading arguments and the local environment from other sources to avoid exposing sensitive values or credentials in plain text within configuration files for CTS and secure the provider. 

## Specify providers

Add the [`terraform_provider` block](/consul/docs/reference/cts#terraform-provider) to your CTS configuration and configure it according to the provider documentation. Refer to the Terraform provider documentation hosted on the [Terraform Registry](https://registry.terraform.io/browse/providers) to find available options.

Many providers have few required parameters and several optional configuration. CTS uses the provider's default settings if you omit the `terraform_provider` block in the CTS configuration.

You may need to configure the providers you reference in the Terraform modules configured for task automation. CTS loads the `terraform_provider` block during runtime and adds configuration values to the [autogenerated Terraform configuration files](/consul/docs/cts/network-drivers#provider) used for task automation. In the following example, the provider requires the host address to interface with the network infrastructure. 

```hcl
terraform_provider "myprovider" {
  address = "myprovider.example.com"
}
```

## Secure Terraform provider configuration

CTS renders provider arguments in plain-text when it generates the `terraform.tvars` file used for th corresponding workspace. If your providers support using environment variables, you can configure CTS to dynamically load arguments and local environment from other sources. This enables you to securely configure your Terraform provider from the shell environment, Consul KV, or Vault. Refer to the official provider docs hosted on the [Terraform Registry](https://registry.terraform.io/browse/providers) to find supported environment variables for a provider. By default, CTS enables all Terraform workspaces to inherit from its environment.

Add the `task_env` meta-argument to the `terraform_provider` block and specify the source. Use configure CTS to query sources using one of the following methods:

- `env`: Use values stored in environment variables. Refer to [Provider environment variables](#provider-environment-variables) for details.
- `key`: Queries Consul KV store for the key's value. Refer to [Consul KV](#consul-kv) for details.
- `from secret`: Queries the Vault KV secrets engine. Refer to [Vault KV secrets engine](#vault-kv-secrets-engine) for details. 

In the following example, CTS uses a local environment variable called `CTS_FOO_TOKEN`:

```hcl
terraform_provider "foo" {
  task_env {
    "FOO_TOKEN" = "{{ env \"CTS_FOO_TOKEN\" }}"
  }
}
```



### Secure state files

CTS does not prevent sensitive values from being written to Terraform state files. We recommend securing state files in addition to securely configuring Terraform providers. Options for securing state files can be set within [`driver.backend`](#backend) based on the backend used. For example, Consul KV is the default backend and can be secured with ACLs for KV path. For other backends, we recommend enabling encryption, if applicable.


### Provider environment variables

The `env` argument reads the given environment variables accessible to CTS. The following example configures the provider to use the address stored in the `EXAMPLE_HOSTNAME` variable.

```hcl
terraform_provider "example" {
  address = "{{ env \"EXAMPLE_HOSTNAME\" }}"
}
```

### Consul KV

The `key` argument queries the Consul server configured in the required [`consul` block](/consul/docs/reference/cts#consul) for the key's value. The following example queries the key stored at `path/example/key`. Refer to the [Consul KV documentation](/consul/docs/dynamic-app/kv) for instructions on how to acquire paths.

```hcl
terraform_provider "example" {
  value = "{{ key \"path/example/key\" }}"
}
```

### Vault KV secrets engine

The `with secret` argument queries the [Vault KV secrets engine](/vault/api-docs/secret/kv). Vault is an optional source that you must configure in the `vault` block. Specify the following values in the CTS configuration file to configure the Vault integration

- `address`: (string) The URI of the Vault server. You can also set this parameter using the `VAULT_ADDR` environment variable.
- `enabled`: (boolean) Set to `true` to enable the Vault integration.
- `namespace`: (string) Specifies the  Vault namespace to use for reading secrets. You can also set this parameter uing the the `VAULT_NAMESPACE` environment variable.
- `renew_token` - (boolean) Renews the Vault token. You can also set this parameter using the `VAULT_RENEW_TOKEN` environment variable.
- `tls`: Map that configures the TLS  connection to Vault. Supports the environment variables:
  - `VAULT_CACERT`
  - `VAULT_CAPATH`
  - `VAULT_CLIENT_CERT`
  - `VAULT_CLIENT_KEY`
  - `VAULT_SKIP_VERIFY`
  - `VAULT_TLS_SERVER_NAME`
- `token` - (string) Token is the Vault token to communicate with for requests. It may be a wrapped token or a real token. This can also be set via the `VAULT_TOKEN` environment variable, or via the `VaultAgentTokenFile`.
- `vault_agent_token_file` - (string) The path of the file that contains a Vault Agent token. If this is specified, CTS does  not attempt to renew the Vault token.
- `transport` - Configures low-level network connection details.
- `unwrap_token` - (bool) Unwraps the provided Vault token as a wrapped token.

Tasks and associated Terraform configurations defined in the CTS configuration, including automated Terraform modules, cannot access Vault credentials. If the task requires Vault, you will need to separately configure the Vault provider and explicitly include it in the `task.providers` list.

After configuring CTS to access Vault, use the following format to query values: 

`Data.data.<secret_key>`.

The following example configures the address of the Vault secrets engine directs CTS to query the engine for a token:

```hcl
vault {
  address = "vault.example.com"
}

terraform_provider "example" {
  token = "{{ with secret \"secret/my/path\" }}{{ .Data.data.foo }}{{ end }}"
}
```